const enableDiggAds=()=>{localStorage.removeItem("disable-digg-ads"),window.location.reload()},disableDiggAds=()=>{localStorage.setItem("disable-digg-ads",!0),window.location.reload()};!function(){if("undefined"!=typeof window)try{var e=new window.CustomEvent("test",{cancelable:!0});if(e.preventDefault(),!0!==e.defaultPrevented)throw new Error("Could not prevent default")}catch(e){var t=function(e,t){var i,r;return t=t||{bubbles:!1,cancelable:!1,detail:void 0},(i=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r=i.preventDefault,i.preventDefault=function(){r.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(e){this.defaultPrevented=!0}},i};t.prototype=window.Event.prototype,window.CustomEvent=t}}(),(()=>{if("undefined"!=typeof diggUserData){const e=document.querySelectorAll(".share-story");e&&e.forEach(e=>{diggUserData.diggs.includes(parseInt(e.dataset.id))&&e.querySelector(".digg").classList.add("active"),diggUserData.saves.includes(parseInt(e.dataset.id))&&e.querySelector(".save").classList.add("active")})}})(),window.addEventListener("load",()=>{}),window.addEventListener("load",()=>{(()=>{Array.prototype.diff=function(e){return this.filter((function(t){return e.indexOf(t)<0}))};const e=document.querySelector(".live-pull.frontpage");if(e){let t=[];e.querySelectorAll("article[data-id]").forEach(e=>{t.push(parseInt(e.dataset.id))}),new EventSource("https://pubsub.digg.com/stream/frontpage").addEventListener("new-stories-available",e=>{const i=JSON.parse(e.data).diff(t).length;if(i>0){let e=document.querySelector(".live-pull-refresh-button"),t="story";i>1&&(t="stories"),e.querySelector("label").innerText=`${i} new ${t} available`,e.classList.add("open"),e.addEventListener("click",e=>{window.location.reload()})}console.log(i)})}})()}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),function(e){"use strict";e.Templates.registerLoader("ajax",(function(t,i,r,n){var s,o,a=i.precompiled,p=this.parsers[i.parser]||this.parser.twig;if("undefined"==typeof XMLHttpRequest)throw new e.Error('Unsupported platform: Unable to do ajax requests because there is no "XMLHTTPRequest" implementation');return(o=new XMLHttpRequest).onreadystatechange=function(){var l=null;4===o.readyState&&(200===o.status||window.cordova&&0==o.status?(e.log.debug("Got template ",o.responseText),l=!0===a?JSON.parse(o.responseText):o.responseText,i.url=t,i.data=l,s=p.call(this,i),"function"==typeof r&&r(s)):"function"==typeof n&&n(o))},o.open("GET",t,!!i.async),o.send(),!!i.async||s}))}(Twig=function(e){"use strict";return e.trace=!1,e.debug=!1,e.cache=!0,e.placeholders={parent:"{{|PARENT|}}"},e.indexOf=function(e,t){if(Array.prototype.hasOwnProperty("indexOf"))return e.indexOf(t);if(null==e)throw new TypeError;var i=Object(e),r=i.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>0&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==1/0&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var s=n>=0?n:Math.max(r-Math.abs(n),0);s<r;s++)if(s in i&&i[s]===t)return s;return e==t?0:-1},e.forEach=function(e,t,i){if(Array.prototype.forEach)return e.forEach(t,i);var r,n;if(null==e)throw new TypeError(" this is null or not defined");var s=Object(e),o=s.length>>>0;if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(i&&(r=i),n=0;n<o;){var a;n in s&&(a=s[n],t.call(r,a,n,s)),n++}},e.merge=function(t,i,r){return e.forEach(Object.keys(i),(function(e){(!r||e in t)&&(t[e]=i[e])})),t},e.Error=function(e){this.message=e,this.name="TwigException",this.type="TwigException"},e.Error.prototype.toString=function(){return this.name+": "+this.message},e.log={trace:function(){e.trace&&console&&console.log(Array.prototype.slice.call(arguments))},debug:function(){e.debug&&console&&console.log(Array.prototype.slice.call(arguments))}},"undefined"!=typeof console?void 0!==console.error?e.log.error=function(){console.error.apply(console,arguments)}:void 0!==console.log&&(e.log.error=function(){console.log.apply(console,arguments)}):e.log.error=function(){},e.ChildContext=function(e){var t=function(){};return t.prototype=e,new t},e.token={},e.token.type={output:"output",logic:"logic",comment:"comment",raw:"raw",output_whitespace_pre:"output_whitespace_pre",output_whitespace_post:"output_whitespace_post",output_whitespace_both:"output_whitespace_both",logic_whitespace_pre:"logic_whitespace_pre",logic_whitespace_post:"logic_whitespace_post",logic_whitespace_both:"logic_whitespace_both"},e.token.definitions=[{type:e.token.type.raw,open:"{% raw %}",close:"{% endraw %}"},{type:e.token.type.raw,open:"{% verbatim %}",close:"{% endverbatim %}"},{type:e.token.type.output_whitespace_pre,open:"{{-",close:"}}"},{type:e.token.type.output_whitespace_post,open:"{{",close:"-}}"},{type:e.token.type.output_whitespace_both,open:"{{-",close:"-}}"},{type:e.token.type.logic_whitespace_pre,open:"{%-",close:"%}"},{type:e.token.type.logic_whitespace_post,open:"{%",close:"-%}"},{type:e.token.type.logic_whitespace_both,open:"{%-",close:"-%}"},{type:e.token.type.output,open:"{{",close:"}}"},{type:e.token.type.logic,open:"{%",close:"%}"},{type:e.token.type.comment,open:"{#",close:"#}"}],e.token.strings=['"',"'"],e.token.findStart=function(t){var i,r,n,s,o={position:null,close_position:null,def:null};for(i=0;i<e.token.definitions.length;i++)r=e.token.definitions[i],n=t.indexOf(r.open),s=t.indexOf(r.close),e.log.trace("Twig.token.findStart: ","Searching for ",r.open," found at ",n),n>=0&&r.open.length!==r.close.length&&s<0||(n>=0&&(null===o.position||n<o.position)?(o.position=n,o.def=r,o.close_position=s):n>=0&&null!==o.position&&n===o.position&&(r.open.length>o.def.open.length?(o.position=n,o.def=r,o.close_position=s):r.open.length===o.def.open.length&&(r.close.length,o.def.close.length,s>=0&&s<o.close_position&&(o.position=n,o.def=r,o.close_position=s))));return delete o.close_position,o},e.token.findEnd=function(t,i,r){for(var n,s,o=null,a=!1,p=0,l=null,c=null,u=null,d=null,m=null,h=null;!a;){if(l=null,c=null,!((u=t.indexOf(i.close,p))>=0))throw new e.Error("Unable to find closing bracket '"+i.close+"' opened near template position "+r);if(o=u,a=!0,i.type===e.token.type.comment)break;if(i.type===e.token.type.raw)break;for(s=e.token.strings.length,n=0;n<s;n+=1)(m=t.indexOf(e.token.strings[n],p))>0&&m<u&&(null===l||m<l)&&(l=m,c=e.token.strings[n]);if(null!==l)for(d=l+1,o=null,a=!1;;){if((h=t.indexOf(c,d))<0)throw"Unclosed string in template";if("\\"!==t.substr(h-1,1)){p=h+1;break}d=h+1}}return o},e.tokenize=function(t){for(var i=[],r=0,n=null,s=null;t.length>0;)if(n=e.token.findStart(t),e.log.trace("Twig.tokenize: ","Found token: ",n),null!==n.position){if(n.position>0&&i.push({type:e.token.type.raw,value:t.substring(0,n.position)}),t=t.substr(n.position+n.def.open.length),r+=n.position+n.def.open.length,s=e.token.findEnd(t,n.def,r),e.log.trace("Twig.tokenize: ","Token ends at ",s),i.push({type:n.def.type,value:t.substring(0,s).trim()}),"\n"===t.substr(s+n.def.close.length,1))switch(n.def.type){case"logic_whitespace_pre":case"logic_whitespace_post":case"logic_whitespace_both":case"logic":s+=1}t=t.substr(s+n.def.close.length),r+=s+n.def.close.length}else i.push({type:e.token.type.raw,value:t}),t="";return i},e.compile=function(t){try{for(var i=[],r=[],n=[],s=null,o=null,a=null,p=null,l=null,c=null,u=null,d=null,m=null,h=null,g=null,f=null,y=function(t){e.expression.compile.apply(this,[t]),r.length>0?n.push(t):i.push(t)},v=function(t){if(o=e.logic.compile.apply(this,[t]),h=o.type,g=e.logic.handler[h].open,f=e.logic.handler[h].next,e.log.trace("Twig.compile: ","Compiled logic token to ",o," next is: ",f," open is : ",g),void 0!==g&&!g){if(p=r.pop(),u=e.logic.handler[p.type],e.indexOf(u.next,h)<0)throw new Error(h+" not expected after a "+p.type);p.output=p.output||[],p.output=p.output.concat(n),n=[],m={type:e.token.type.logic,token:p},r.length>0?n.push(m):i.push(m)}void 0!==f&&f.length>0?(e.log.trace("Twig.compile: ","Pushing ",o," to logic stack."),r.length>0&&((p=r.pop()).output=p.output||[],p.output=p.output.concat(n),r.push(p),n=[]),r.push(o)):void 0!==g&&g&&(m={type:e.token.type.logic,token:o},r.length>0?n.push(m):i.push(m))};t.length>0;){switch(s=t.shift(),l=i[i.length-1],c=n[n.length-1],d=t[0],e.log.trace("Compiling token ",s),s.type){case e.token.type.raw:r.length>0?n.push(s):i.push(s);break;case e.token.type.logic:v.call(this,s);break;case e.token.type.comment:break;case e.token.type.output:y.call(this,s);break;case e.token.type.logic_whitespace_pre:case e.token.type.logic_whitespace_post:case e.token.type.logic_whitespace_both:case e.token.type.output_whitespace_pre:case e.token.type.output_whitespace_post:case e.token.type.output_whitespace_both:switch(s.type!==e.token.type.output_whitespace_post&&s.type!==e.token.type.logic_whitespace_post&&(l&&l.type===e.token.type.raw&&(i.pop(),null===l.value.match(/^\s*$/)&&(l.value=l.value.trim(),i.push(l))),c&&c.type===e.token.type.raw&&(n.pop(),null===c.value.match(/^\s*$/)&&(c.value=c.value.trim(),n.push(c)))),s.type){case e.token.type.output_whitespace_pre:case e.token.type.output_whitespace_post:case e.token.type.output_whitespace_both:y.call(this,s);break;case e.token.type.logic_whitespace_pre:case e.token.type.logic_whitespace_post:case e.token.type.logic_whitespace_both:v.call(this,s)}s.type!==e.token.type.output_whitespace_pre&&s.type!==e.token.type.logic_whitespace_pre&&d&&d.type===e.token.type.raw&&(t.shift(),null===d.value.match(/^\s*$/)&&(d.value=d.value.trim(),t.unshift(d)))}e.log.trace("Twig.compile: "," Output: ",i," Logic Stack: ",r," Pending Output: ",n)}if(r.length>0)throw a=r.pop(),new Error("Unable to find an end tag for "+a.type+", expecting one of "+a.next);return i}catch(t){if(e.log.error("Error compiling twig template "+this.id+": "),t.stack?e.log.error(t.stack):e.log.error(t.toString()),this.options.rethrow)throw t}},e.parse=function(t,i){try{var r=[],n=!0,s=this;return e.forEach(t,(function(t){switch(e.log.debug("Twig.parse: ","Parsing token: ",t),t.type){case e.token.type.raw:r.push(e.filters.raw(t.value));break;case e.token.type.logic:var o=t.token,a=e.logic.parse.apply(s,[o,i,n]);void 0!==a.chain&&(n=a.chain),void 0!==a.context&&(i=a.context),void 0!==a.output&&r.push(a.output);break;case e.token.type.comment:break;case e.token.type.output_whitespace_pre:case e.token.type.output_whitespace_post:case e.token.type.output_whitespace_both:case e.token.type.output:e.log.debug("Twig.parse: ","Output token: ",t.stack),r.push(e.expression.parse.apply(s,[t.stack,i]))}})),e.output.apply(this,[r])}catch(t){if(e.log.error("Error parsing twig template "+this.id+": "),t.stack?e.log.error(t.stack):e.log.error(t.toString()),this.options.rethrow)throw t;if(e.debug)return t.toString()}},e.prepare=function(t){var i,r;return e.log.debug("Twig.prepare: ","Tokenizing ",t),r=e.tokenize.apply(this,[t]),e.log.debug("Twig.prepare: ","Compiling ",r),i=e.compile.apply(this,[r]),e.log.debug("Twig.prepare: ","Compiled ",i),i},e.output=function(t){if(!this.options.autoescape)return t.join("");var i="html";"string"==typeof this.options.autoescape&&(i=this.options.autoescape);var r=[];return e.forEach(t,(function(t){t&&!0!==t.twig_markup&&t.twig_markup!=i&&(t=e.filters.escape(t,[i])),r.push(t)})),e.Markup(r.join(""))},e.Templates={loaders:{},parsers:{},registry:{}},e.validateId=function(t){if("prototype"===t)throw new e.Error(t+" is not a valid twig identifier");if(e.cache&&e.Templates.registry.hasOwnProperty(t))throw new e.Error("There is already a template with the ID "+t);return!0},e.Templates.registerLoader=function(t,i,r){if("function"!=typeof i)throw new e.Error("Unable to add loader for "+t+": Invalid function reference given.");r&&(i=i.bind(r)),this.loaders[t]=i},e.Templates.unRegisterLoader=function(e){this.isRegisteredLoader(e)&&delete this.loaders[e]},e.Templates.isRegisteredLoader=function(e){return this.loaders.hasOwnProperty(e)},e.Templates.registerParser=function(t,i,r){if("function"!=typeof i)throw new e.Error("Unable to add parser for "+t+": Invalid function regerence given.");r&&(i=i.bind(r)),this.parsers[t]=i},e.Templates.unRegisterParser=function(e){this.isRegisteredParser(e)&&delete this.parsers[e]},e.Templates.isRegisteredParser=function(e){return this.parsers.hasOwnProperty(e)},e.Templates.save=function(t){if(void 0===t.id)throw new e.Error("Unable to save template with no id");e.Templates.registry[t.id]=t},e.Templates.load=function(t){return e.Templates.registry.hasOwnProperty(t)?e.Templates.registry[t]:null},e.Templates.loadRemote=function(t,i,r,n){return void 0===i.async&&(i.async=!0),void 0===i.id&&(i.id=t),e.cache&&e.Templates.registry.hasOwnProperty(i.id)?("function"==typeof r&&r(e.Templates.registry[i.id]),e.Templates.registry[i.id]):(i.parser=i.parser||"twig",(this.loaders[i.method]||this.loaders.fs).apply(this,arguments))},e.Template=function(t){var i,r,n,s=t.data,o=t.id,a=t.blocks,p=t.macros||{},l=t.base,c=t.path,u=t.url,d=t.name,m=t.method,h=t.options;this.id=o,this.method=m,this.base=l,this.path=c,this.url=u,this.name=d,this.macros=p,this.options=h,this.reset(a),i="String",r=s,n=Object.prototype.toString.call(r).slice(8,-1),this.tokens=null!=r&&n===i?e.prepare.apply(this,[s]):s,void 0!==o&&e.Templates.save(this)},e.Template.prototype.reset=function(t){e.log.debug("Twig.Template.reset","Reseting template "+this.id),this.blocks={},this.importedBlocks=[],this.originalBlockTokens={},this.child={blocks:t||{}},this.extend=null},e.Template.prototype.render=function(t,i){var r,n,s;return i=i||{},this.context=t||{},this.reset(),i.blocks&&(this.blocks=i.blocks),i.macros&&(this.macros=i.macros),r=e.parse.apply(this,[this.tokens,this.context]),this.extend?(this.options.allowInlineIncludes&&(s=e.Templates.load(this.extend))&&(s.options=this.options),s||(n=e.path.parsePath(this,this.extend),s=e.Templates.loadRemote(n,{method:this.getLoaderMethod(),base:this.base,async:!1,id:n,options:this.options})),this.parent=s,this.parent.render(this.context,{blocks:this.blocks})):"blocks"==i.output?this.blocks:"macros"==i.output?this.macros:r},e.Template.prototype.importFile=function(t){var i,r;if(!this.url&&this.options.allowInlineIncludes){if(t=this.path?this.path+"/"+t:t,!(r=e.Templates.load(t))&&!(r=e.Templates.loadRemote(i,{id:t,method:this.getLoaderMethod(),async:!1,options:this.options})))throw new e.Error("Unable to find the template "+t);return r.options=this.options,r}return i=e.path.parsePath(this,t),r=e.Templates.loadRemote(i,{method:this.getLoaderMethod(),base:this.base,async:!1,options:this.options,id:i})},e.Template.prototype.importBlocks=function(t,i){var r=this.importFile(t),n=this.context,s=this;i=i||!1,r.render(n),e.forEach(Object.keys(r.blocks),(function(e){(i||void 0===s.blocks[e])&&(s.blocks[e]=r.blocks[e],s.importedBlocks.push(e))}))},e.Template.prototype.importMacros=function(t){var i=e.path.parsePath(this,t);return e.Templates.loadRemote(i,{method:this.getLoaderMethod(),async:!1,id:i})},e.Template.prototype.getLoaderMethod=function(){return this.path?"fs":this.url?"ajax":this.method||"fs"},e.Template.prototype.compile=function(t){return e.compiler.compile(this,t)},e.Markup=function(e,t){return void 0===t&&(t=!0),"string"==typeof e&&e.length>0&&((e=new String(e)).twig_markup=t),e},e}((Twig=function(e){return e.VERSION="0.8.9",e}(Twig||{}))||{})),function(e){"use strict";var t,i;try{t=require("fs"),i=require("path")}catch(e){}e.Templates.registerLoader("fs",(function(r,n,s,o){var a,p=null,l=n.precompiled,c=this.parsers[n.parser]||this.parser.twig;if(!t||!i)throw new e.Error('Unsupported platform: Unable to load from file because there is no "fs" or "path" implementation');var u=function(e,t){e?"function"==typeof o&&o(e):(!0===l&&(t=JSON.parse(t)),n.data=t,n.path=n.path||r,a=c.call(this,n),"function"==typeof s&&s(a))};if(n.path=n.path||r,n.async)return t.stat(n.path,(function(i,s){if(i||!s.isFile())throw new e.Error("Unable to find template file "+r);t.readFile(n.path,"utf8",u)})),!0;if(!t.statSync(n.path).isFile())throw new e.Error("Unable to find template file "+r);return p=t.readFileSync(n.path,"utf8"),u(void 0,p),a}))}(Twig),function(e){"use strict";e.Templates.registerParser("source",(function(e){return e.data||""}))}(Twig),function(e){"use strict";e.Templates.registerParser("twig",(function(t){return new e.Template(t)}))}(Twig),function(){"use strict";String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i})}();var Twig=function(e){return e.compiler={module:{}},e.compiler.compile=function(t,i){var r,n=JSON.stringify(t.tokens),s=t.id;if(i.module){if(void 0===e.compiler.module[i.module])throw new e.Error("Unable to find module type "+i.module);r=e.compiler.module[i.module](s,n,i.twig)}else r=e.compiler.wrap(s,n);return r},e.compiler.module={amd:function(t,i,r){return'define(["'+r+'"], function (Twig) {\n\tvar twig, templates;\ntwig = Twig.twig;\ntemplates = '+e.compiler.wrap(t,i)+"\n\treturn templates;\n});"},node:function(t,i){return'var twig = require("twig").twig;\nexports.template = '+e.compiler.wrap(t,i)},cjs2:function(t,i,r){return'module.declare([{ twig: "'+r+'" }], function (require, exports, module) {\n\tvar twig = require("twig").twig;\n\texports.template = '+e.compiler.wrap(t,i)+"\n});"}},e.compiler.wrap=function(e,t){return'twig({id:"'+e.replace('"','\\"')+'", data:'+t+", precompiled: true});\n"},e}((Twig=function(e){"use strict";return e.exports={VERSION:e.VERSION},e.exports.twig=function(t){var i=t.id,r={strict_variables:t.strict_variables||!1,autoescape:null!=t.autoescape&&t.autoescape||!1,allowInlineIncludes:t.allowInlineIncludes||!1,rethrow:t.rethrow||!1,namespaces:t.namespaces};if(e.cache&&i&&e.validateId(i),void 0!==t.debug&&(e.debug=t.debug),void 0!==t.trace&&(e.trace=t.trace),void 0!==t.data)return e.Templates.parsers.twig({data:t.data,path:t.hasOwnProperty("path")?t.path:void 0,module:t.module,id:i,options:r});if(void 0!==t.ref){if(void 0!==t.id)throw new e.Error("Both ref and id cannot be set on a twig.js template.");return e.Templates.load(t.ref)}if(void 0!==t.method){if(!e.Templates.isRegisteredLoader(t.method))throw new e.Error('Loader for "'+t.method+'" is not defined.');return e.Templates.loadRemote(t.name||t.href||t.path||i||void 0,{id:i,method:t.method,parser:t.parser||"twig",base:t.base,module:t.module,precompiled:t.precompiled,async:t.async,options:r},t.load,t.error)}return void 0!==t.href?e.Templates.loadRemote(t.href,{id:i,method:"ajax",parser:t.parser||"twig",base:t.base,module:t.module,precompiled:t.precompiled,async:t.async,options:r},t.load,t.error):void 0!==t.path?e.Templates.loadRemote(t.path,{id:i,method:"fs",parser:t.parser||"twig",base:t.base,module:t.module,precompiled:t.precompiled,async:t.async,options:r},t.load,t.error):void 0},e.exports.extendFilter=function(t,i){e.filter.extend(t,i)},e.exports.extendFunction=function(t,i){e._function.extend(t,i)},e.exports.extendTest=function(t,i){e.test.extend(t,i)},e.exports.extendTag=function(t){e.logic.extend(t)},e.exports.extend=function(t){t(e)},e.exports.compile=function(t,i){var r,n=i.filename,s=i.filename;return r=new e.Template({data:t,path:s,id:n,options:i.settings["twig options"]}),function(e){return r.render(e)}},e.exports.renderFile=function(t,i,r){"function"==typeof i&&(r=i,i={});var n=(i=i||{}).settings||{},s={path:t,base:n.views,load:function(e){r(null,e.render(i))}},o=n["twig options"];if(o)for(var a in o)o.hasOwnProperty(a)&&(s[a]=o[a]);e.exports.twig(s)},e.exports.__express=e.exports.renderFile,e.exports.cache=function(t){e.cache=t},e.exports.path=e.path,e}((Twig=function(e){"use strict";return e.tests={empty:function(e){if(null==e)return!0;if("number"==typeof e)return!1;if(e.length&&e.length>0)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},odd:function(e){return e%2==1},even:function(e){return e%2==0},divisibleby:function(e,t){return e%t[0]==0},defined:function(e){return void 0!==e},none:function(e){return null===e},null:function(e){return this.none(e)},sameas:function(e,t){return e===t[0]},iterable:function(t){return t&&(e.lib.is("Array",t)||e.lib.is("Object",t))}},e.test=function(t,i,r){if(!e.tests[t])throw"Test "+t+" is not defined.";return e.tests[t](i,r)},e.test.extend=function(t,i){e.tests[t]=i},e}((Twig=function(e){"use strict";return e.path={},e.path.parsePath=function(t,i){var r=null;i=i||"";if("object"==typeof t&&"object"==typeof t.options&&(r=t.options.namespaces),"object"==typeof r&&i.indexOf("::")>0||i.indexOf("@")>=0){for(var n in r)r.hasOwnProperty(n)&&(i=(i=i.replace(n+"::",r[n])).replace("@"+n,r[n]));return i}return e.path.relativePath(t,i)},e.path.relativePath=function(t,i){var r,n,s,o="/",a=[];i=i||"";if(t.url)r=void 0!==t.base?t.base+("/"===t.base.charAt(t.base.length-1)?"":"/"):t.url;else if(t.path){var p=require("path"),l=p.sep||o,c=new RegExp("^\\.{1,2}"+l.replace("\\","\\\\"));i=i.replace(/\//g,l),void 0!==t.base&&null==i.match(c)?(i=i.replace(t.base,""),r=t.base+l):r=p.normalize(t.path),r=r.replace(l+l,l),o=l}else{if(!t.name&&!t.id||!t.method||"fs"===t.method||"ajax"===t.method)throw new e.Error("Cannot extend an inline template.");r=t.base||t.name||t.id}for((n=r.split(o)).pop(),n=n.concat(i.split(o));n.length>0;)"."==(s=n.shift())||(".."==s&&a.length>0&&".."!=a[a.length-1]?a.pop():a.push(s));return a.join(o)},e}((Twig=function(e){return e.functions={range:function(e,t,i){var r,n,s=[],o=i||1,a=!1;if(isNaN(e)||isNaN(t)?isNaN(e)&&isNaN(t)?(a=!0,r=e.charCodeAt(0),n=t.charCodeAt(0)):(r=isNaN(e)?0:e,n=isNaN(t)?0:t):(r=parseInt(e,10),n=parseInt(t,10)),!(r>n))for(;r<=n;)s.push(a?String.fromCharCode(r):r),r+=o;else for(;r>=n;)s.push(a?String.fromCharCode(r):r),r-=o;return s},cycle:function(e,t){return e[t%e.length]},dump:function(){var t="\n",i="  ",r=0,n="",s=Array.prototype.slice.call(arguments),o=function(e){for(var t="";e>0;)e--,t+=i;return t},a=function(e){n+=o(r),"object"==typeof e?p(e):"function"==typeof e?n+="function()"+t:"string"==typeof e?n+="string("+e.length+') "'+e+'"'+t:"number"==typeof e?n+="number("+e+")"+t:"boolean"==typeof e&&(n+="bool("+e+")"+t)},p=function(e){var i;if(null===e)n+="NULL"+t;else if(void 0===e)n+="undefined"+t;else if("object"==typeof e){for(i in n+=o(r)+typeof e,r++,n+="("+function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i}(e)+") {"+t,e)n+=o(r)+"["+i+"]=> "+t,a(e[i]);r--,n+=o(r)+"}"+t}else a(e)};return 0==s.length&&s.push(this.context),e.forEach(s,(function(e){p(e)})),n},date:function(t,i){var r;if(void 0===t)r=new Date;else if(e.lib.is("Date",t))r=t;else if(e.lib.is("String",t))r=t.match(/^[0-9]+$/)?new Date(1e3*t):new Date(1e3*e.lib.strtotime(t));else{if(!e.lib.is("Number",t))throw new e.Error("Unable to parse date "+t);r=new Date(1e3*t)}return r},block:function(t){return this.originalBlockTokens[t]?e.logic.parse.apply(this,[this.originalBlockTokens[t],this.context]).output:this.blocks[t]},parent:function(){return e.placeholders.parent},attribute:function(t,i,r){return e.lib.is("Object",t)&&t.hasOwnProperty(i)?"function"==typeof t[i]?t[i].apply(void 0,r):t[i]:t[i]||void 0},max:function(t){return e.lib.is("Object",t)?(delete t._keys,e.lib.max(t)):e.lib.max.apply(null,arguments)},min:function(t){return e.lib.is("Object",t)?(delete t._keys,e.lib.min(t)):e.lib.min.apply(null,arguments)},template_from_string:function(t){return void 0===t&&(t=""),e.Templates.parsers.twig({options:this.options,data:t})},random:function(t){function i(e){var t=Math.floor(2147483648*Math.random()),i=[0,e],r=Math.min.apply(null,i),n=Math.max.apply(null,i);return r+Math.floor((n-r+1)*t/2147483648)}if(e.lib.is("Number",t))return i(t);if(e.lib.is("String",t))return t.charAt(i(t.length-1));if(e.lib.is("Array",t))return t[i(t.length-1)];if(e.lib.is("Object",t)){var r=Object.keys(t);return t[r[i(r.length-1)]]}return i(2147483647)},source:function(t,i){var r,n,s,o=!1;"undefined"!=typeof module&&void 0!==module.exports&&"undefined"==typeof window?(n="fs",s=__dirname+"/"+t):(n="ajax",s=t);var a={id:t,path:s,method:n,parser:"source",async:!1,fetchTemplateSource:!0};void 0===i&&(i=!1);try{null==(r=e.Templates.loadRemote(t,a))?r="":o=!0}catch(t){e.log.debug("Twig.functions.source: ","Problem loading template  ",t)}return o||i?r:'Template "{name}" is not defined.'.replace("{name}",t)}},e._function=function(t,i,r){if(!e.functions[t])throw"Unable to find function "+t;return e.functions[t](i,r)},e._function.extend=function(t,i){e.functions[t]=i},e}((Twig=function(e){function t(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&i===e}return e.filters={upper:function(e){return"string"!=typeof e?e:e.toUpperCase()},lower:function(e){return"string"!=typeof e?e:e.toLowerCase()},capitalize:function(e){return"string"!=typeof e?e:e.substr(0,1).toUpperCase()+e.toLowerCase().substr(1)},title:function(e){return"string"!=typeof e?e:e.toLowerCase().replace(/(^|\s)([a-z])/g,(function(e,t,i){return t+i.toUpperCase()}))},length:function(t){return e.lib.is("Array",t)||"string"==typeof t?t.length:e.lib.is("Object",t)?void 0===t._keys?Object.keys(t).length:t._keys.length:0},reverse:function(e){if(t("Array",e))return e.reverse();if(t("String",e))return e.split("").reverse().join("");if(t("Object",e)){var i=e._keys||Object.keys(e).reverse();return e._keys=i,e}},sort:function(e){if(t("Array",e))return e.sort();if(t("Object",e)){delete e._keys;var i=Object.keys(e).sort((function(t,i){var r;return e[t]>e[i]==!(e[t]<=e[i])?e[t]>e[i]?1:e[t]<e[i]?-1:0:isNaN(r=parseFloat(e[t]))||isNaN(b1=parseFloat(e[i]))?"string"==typeof e[t]?e[t]>e[i].toString()?1:e[t]<e[i].toString()?-1:0:"string"==typeof e[i]?e[t].toString()>e[i]?1:e[t].toString()<e[i]?-1:0:null:r>b1?1:r<b1?-1:0}));return e._keys=i,e}},keys:function(t){if(null!=t){var i=t._keys||Object.keys(t),r=[];return e.forEach(i,(function(e){"_keys"!==e&&t.hasOwnProperty(e)&&r.push(e)})),r}},url_encode:function(e){if(null!=e){var t=encodeURIComponent(e);return t=t.replace("'","%27")}},join:function(i,r){if(null!=i){var n="",s=[],o=null;return r&&r[0]&&(n=r[0]),t("Array",i)?s=i:(o=i._keys||Object.keys(i),e.forEach(o,(function(e){"_keys"!==e&&i.hasOwnProperty(e)&&s.push(i[e])}))),s.join(n)}},default:function(t,i){if(void 0!==i&&i.length>1)throw new e.Error("default filter expects one argument");return null==t||""===t?void 0===i?"":i[0]:t},json_encode:function(i){if(null==i)return"null";if("object"==typeof i&&t("Array",i))return n=[],e.forEach(i,(function(t){n.push(e.filters.json_encode(t))})),"["+n.join(",")+"]";if("object"==typeof i){var r=i._keys||Object.keys(i),n=[];return e.forEach(r,(function(t){n.push(JSON.stringify(t)+":"+e.filters.json_encode(i[t]))})),"{"+n.join(",")+"}"}return JSON.stringify(i)},merge:function(i,r){var n=[],s=0,o=[];if(t("Array",i)?e.forEach(r,(function(e){t("Array",e)||(n={})})):n={},t("Array",n)||(n._keys=[]),t("Array",i)?e.forEach(i,(function(e){n._keys&&n._keys.push(s),n[s]=e,s++})):(o=i._keys||Object.keys(i),e.forEach(o,(function(e){n[e]=i[e],n._keys.push(e);var t=parseInt(e,10);!isNaN(t)&&t>=s&&(s=t+1)}))),e.forEach(r,(function(i){t("Array",i)?e.forEach(i,(function(e){n._keys&&n._keys.push(s),n[s]=e,s++})):(o=i._keys||Object.keys(i),e.forEach(o,(function(e){n[e]||n._keys.push(e),n[e]=i[e];var t=parseInt(e,10);!isNaN(t)&&t>=s&&(s=t+1)})))})),0===r.length)throw new e.Error("Filter merge expects at least one parameter");return n},date:function(t,i){var r=e.functions.date(t),n=i&&i.length?i[0]:"F j, Y H:i";return e.lib.formatDate(r,n)},date_modify:function(t,i){if(null!=t){if(void 0===i||1!==i.length)throw new e.Error("date_modify filter expects 1 argument");var r,n=i[0];return e.lib.is("Date",t)&&(r=e.lib.strtotime(n,t.getTime()/1e3)),e.lib.is("String",t)&&(r=e.lib.strtotime(n,e.lib.strtotime(t))),e.lib.is("Number",t)&&(r=e.lib.strtotime(n,t)),new Date(1e3*r)}},replace:function(t,i){if(null!=t){var r,n=i[0];for(r in n)n.hasOwnProperty(r)&&"_keys"!==r&&(t=e.lib.replaceAll(t,r,n[r]));return t}},format:function(t,i){if(null!=t)return e.lib.vsprintf(t,i)},striptags:function(t){if(null!=t)return e.lib.strip_tags(t)},escape:function(t,i){if(null!=t){var r="html";if(i&&i.length&&!0!==i[0]&&(r=i[0]),"html"==r){var n=t.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return e.Markup(n,"html")}if("js"==r){n=t.toString();for(var s="",o=0;o<n.length;o++){if(n[o].match(/^[a-zA-Z0-9,\._]$/))s+=n[o];else s+=(a=n.charCodeAt(o))<128?"\\x"+a.toString(16).toUpperCase():e.lib.sprintf("\\u%04s",a.toString(16).toUpperCase())}return e.Markup(s,"js")}if("css"==r){for(n=t.toString(),s="",o=0;o<n.length;o++){if(n[o].match(/^[a-zA-Z0-9]$/))s+=n[o];else s+="\\"+(a=n.charCodeAt(o)).toString(16).toUpperCase()+" "}return e.Markup(s,"css")}if("url"==r){s=e.filters.url_encode(t);return e.Markup(s,"url")}if("html_attr"==r){for(n=t.toString(),s="",o=0;o<n.length;o++)if(n[o].match(/^[a-zA-Z0-9,\.\-_]$/))s+=n[o];else if(n[o].match(/^[&<>"]$/))s+=n[o].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");else{var a;s+=(a=n.charCodeAt(o))<=31&&9!=a&&10!=a&&13!=a?"&#xFFFD;":a<128?e.lib.sprintf("&#x%02s;",a.toString(16).toUpperCase()):e.lib.sprintf("&#x%04s;",a.toString(16).toUpperCase())}return e.Markup(s,"html_attr")}throw new e.Error("escape strategy unsupported")}},e:function(t,i){return e.filters.escape(t,i)},nl2br:function(t){if(null!=t){var i="<br />BACKSLASH_n_replace";return t=e.filters.escape(t).replace(/\r\n/g,i).replace(/\r/g,i).replace(/\n/g,i),t=e.lib.replaceAll(t,"BACKSLASH_n_replace","\n"),e.Markup(t)}},number_format:function(e,t){var i=e,r=t&&t[0]?t[0]:void 0,n=t&&void 0!==t[1]?t[1]:".",s=t&&void 0!==t[2]?t[2]:",";i=(i+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+i)?+i:0,a=isFinite(+r)?Math.abs(r):0,p="";return(p=(a?function(e,t){var i=Math.pow(10,t);return""+Math.round(e*i)/i}(o,a):""+Math.round(o)).split("."))[0].length>3&&(p[0]=p[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),(p[1]||"").length<a&&(p[1]=p[1]||"",p[1]+=new Array(a-p[1].length+1).join("0")),p.join(n)},trim:function(t,i){if(null!=t){var r,n=e.filters.escape(""+t);r=i&&i[0]?""+i[0]:" \n\r\t\f\v            ​\u2028\u2029　";for(var s=0;s<n.length;s++)if(-1===r.indexOf(n.charAt(s))){n=n.substring(s);break}for(s=n.length-1;s>=0;s--)if(-1===r.indexOf(n.charAt(s))){n=n.substring(0,s+1);break}return-1===r.indexOf(n.charAt(0))?n:""}},truncate:function(e,t){var i=30,r=!1,n="...";if(e+="",t&&(t[0]&&(i=t[0]),t[1]&&(r=t[1]),t[2]&&(n=t[2])),e.length>i){if(r&&-1===(i=e.indexOf(" ",i)))return e;e=e.substr(0,i)+n}return e},slice:function(t,i){if(null!=t){if(void 0===i||i.length<1)throw new e.Error("slice filter expects at least 1 argument");var r=i[0]||0,n=i.length>1?i[1]:t.length,s=r>=0?r:Math.max(t.length+r,0);if(e.lib.is("Array",t)){for(var o=[],a=s;a<s+n&&a<t.length;a++)o.push(t[a]);return o}if(e.lib.is("String",t))return t.substr(s,n);throw new e.Error("slice filter expects value to be an array or string")}},abs:function(e){if(null!=e)return Math.abs(e)},first:function(e){if(t("Array",e))return e[0];if(t("Object",e)){if("_keys"in e)return e[e._keys[0]]}else if("string"==typeof e)return e.substr(0,1)},split:function(t,i){if(null!=t){if(void 0===i||i.length<1||i.length>2)throw new e.Error("split filter expects 1 or 2 argument");if(e.lib.is("String",t)){var r=i[0],n=i[1],s=t.split(r);if(void 0===n)return s;if(n<0)return t.split(r,s.length+n);var o=[];if(""==r)for(;s.length>0;){for(var a="",p=0;p<n&&s.length>0;p++)a+=s.shift();o.push(a)}else{for(p=0;p<n-1&&s.length>0;p++)o.push(s.shift());s.length>0&&o.push(s.join(r))}return o}throw new e.Error("split filter expects value to be a string")}},last:function(t){var i;return e.lib.is("Object",t)?t[(i=void 0===t._keys?Object.keys(t):t._keys)[i.length-1]]:t[t.length-1]},raw:function(t){return e.Markup(t)},batch:function(t,i){var r,n,s,o=i.shift(),a=i.shift();if(!e.lib.is("Array",t))throw new e.Error("batch filter expects items to be an array");if(!e.lib.is("Number",o))throw new e.Error("batch filter expects size to be a number");if(o=Math.ceil(o),r=e.lib.chunkArray(t,o),a&&t.length%o!=0){for(s=o-(n=r.pop()).length;s--;)n.push(a);r.push(n)}return r},round:function(t,i){var r=(i=i||[]).length>0?i[0]:0,n=i.length>1?i[1]:"common";if(t=parseFloat(t),r&&!e.lib.is("Number",r))throw new e.Error("round filter expects precision to be a number");if("common"===n)return e.lib.round(t,r);if(!e.lib.is("Function",Math[n]))throw new e.Error("round filter expects method to be 'floor', 'ceil', or 'common'");return Math[n](t*Math.pow(10,r))/Math.pow(10,r)}},e.filter=function(t,i,r){if(!e.filters[t])throw"Unable to find filter "+t;return e.filters[t].apply(this,[i,r])},e.filter.extend=function(t,i){e.filters[t]=i},e}((Twig=function(e){"use strict";e.expression.operator={leftToRight:"leftToRight",rightToLeft:"rightToLeft"};var t=function(e,t){if(null==t)return null;if(void 0!==t.indexOf)return e===t||""!==e&&t.indexOf(e)>-1;var i;for(i in t)if(t.hasOwnProperty(i)&&t[i]===e)return!0;return!1};return e.expression.operator.lookup=function(t,i){switch(t){case"..":case"not in":case"in":i.precidence=20,i.associativity=e.expression.operator.leftToRight;break;case",":i.precidence=18,i.associativity=e.expression.operator.leftToRight;break;case"?":case":":i.precidence=16,i.associativity=e.expression.operator.rightToLeft;break;case"or":i.precidence=14,i.associativity=e.expression.operator.leftToRight;break;case"and":i.precidence=13,i.associativity=e.expression.operator.leftToRight;break;case"==":case"!=":i.precidence=9,i.associativity=e.expression.operator.leftToRight;break;case"<":case"<=":case">":case">=":i.precidence=8,i.associativity=e.expression.operator.leftToRight;break;case"~":case"+":case"-":i.precidence=6,i.associativity=e.expression.operator.leftToRight;break;case"//":case"**":case"*":case"/":case"%":i.precidence=5,i.associativity=e.expression.operator.leftToRight;break;case"not":i.precidence=3,i.associativity=e.expression.operator.rightToLeft;break;default:throw new e.Error(t+" is an unknown operator.")}return i.operator=t,i},e.expression.operator.parse=function(i,r){var n,s,o;switch(e.log.trace("Twig.expression.operator.parse: ","Handling ",i),i){case":":break;case"?":o=r.pop(),s=r.pop(),(n=r.pop())?r.push(s):r.push(o);break;case"+":s=parseFloat(r.pop()),n=parseFloat(r.pop()),r.push(n+s);break;case"-":s=parseFloat(r.pop()),n=parseFloat(r.pop()),r.push(n-s);break;case"*":s=parseFloat(r.pop()),n=parseFloat(r.pop()),r.push(n*s);break;case"/":s=parseFloat(r.pop()),n=parseFloat(r.pop()),r.push(n/s);break;case"//":s=parseFloat(r.pop()),n=parseFloat(r.pop()),r.push(parseInt(n/s));break;case"%":s=parseFloat(r.pop()),n=parseFloat(r.pop()),r.push(n%s);break;case"~":s=r.pop(),n=r.pop(),r.push((null!=n?n.toString():"")+(null!=s?s.toString():""));break;case"not":case"!":r.push(!r.pop());break;case"<":s=r.pop(),n=r.pop(),r.push(n<s);break;case"<=":s=r.pop(),n=r.pop(),r.push(n<=s);break;case">":s=r.pop(),n=r.pop(),r.push(n>s);break;case">=":s=r.pop(),n=r.pop(),r.push(n>=s);break;case"===":s=r.pop(),n=r.pop(),r.push(n===s);break;case"==":s=r.pop(),n=r.pop(),r.push(n==s);break;case"!==":s=r.pop(),n=r.pop(),r.push(n!==s);break;case"!=":s=r.pop(),n=r.pop(),r.push(n!=s);break;case"or":s=r.pop(),n=r.pop(),r.push(n||s);break;case"and":s=r.pop(),n=r.pop(),r.push(n&&s);break;case"**":s=r.pop(),n=r.pop(),r.push(Math.pow(n,s));break;case"not in":s=r.pop(),n=r.pop(),r.push(!t(n,s));break;case"in":s=r.pop(),n=r.pop(),r.push(t(n,s));break;case"..":s=r.pop(),n=r.pop(),r.push(e.functions.range(n,s));break;default:throw new e.Error(i+" is an unknown operator.")}},e}((Twig=function(e){"use strict";for(e.expression={},e.expression.reservedWords=["true","false","null","TRUE","FALSE","NULL","_context"],e.expression.type={comma:"Twig.expression.type.comma",operator:{unary:"Twig.expression.type.operator.unary",binary:"Twig.expression.type.operator.binary"},string:"Twig.expression.type.string",bool:"Twig.expression.type.bool",array:{start:"Twig.expression.type.array.start",end:"Twig.expression.type.array.end"},object:{start:"Twig.expression.type.object.start",end:"Twig.expression.type.object.end"},parameter:{start:"Twig.expression.type.parameter.start",end:"Twig.expression.type.parameter.end"},key:{period:"Twig.expression.type.key.period",brackets:"Twig.expression.type.key.brackets"},filter:"Twig.expression.type.filter",_function:"Twig.expression.type._function",variable:"Twig.expression.type.variable",number:"Twig.expression.type.number",_null:"Twig.expression.type.null",context:"Twig.expression.type.context",test:"Twig.expression.type.test"},e.expression.set={operations:[e.expression.type.filter,e.expression.type.operator.unary,e.expression.type.operator.binary,e.expression.type.array.end,e.expression.type.object.end,e.expression.type.parameter.end,e.expression.type.comma,e.expression.type.test],expressions:[e.expression.type._function,e.expression.type.bool,e.expression.type.string,e.expression.type.variable,e.expression.type.number,e.expression.type._null,e.expression.type.context,e.expression.type.parameter.start,e.expression.type.array.start,e.expression.type.object.start]},e.expression.set.operations_extended=e.expression.set.operations.concat([e.expression.type.key.period,e.expression.type.key.brackets]),e.expression.fn={compile:{push:function(e,t,i){i.push(e)},push_both:function(e,t,i){i.push(e),t.push(e)}},parse:{push:function(e,t,i){t.push(e)},push_value:function(e,t,i){t.push(e.value)}}},e.expression.definitions=[{type:e.expression.type.test,regex:/^is\s+(not)?\s*([a-zA-Z_][a-zA-Z0-9_]*)/,next:e.expression.set.operations.concat([e.expression.type.parameter.start]),compile:function(e,t,i){e.filter=e.match[2],e.modifier=e.match[1],delete e.match,delete e.value,i.push(e)},parse:function(t,i,r){var n=i.pop(),s=t.params&&e.expression.parse.apply(this,[t.params,r]),o=e.test(t.filter,n,s);"not"==t.modifier?i.push(!o):i.push(o)}},{type:e.expression.type.comma,regex:/^,/,next:e.expression.set.expressions.concat([e.expression.type.array.end,e.expression.type.object.end]),compile:function(t,i,r){var n,s=i.length-1;for(delete t.match,delete t.value;s>=0;s--){if((n=i.pop()).type===e.expression.type.object.start||n.type===e.expression.type.parameter.start||n.type===e.expression.type.array.start){i.push(n);break}r.push(n)}r.push(t)}},{type:e.expression.type.operator.binary,regex:/(^[\+\-~%\?\:]|^[!=]==?|^[!<>]=?|^\*\*?|^\/\/?|^and\s+|^or\s+|^in\s+|^not in\s+|^\.\.)/,next:e.expression.set.expressions.concat([e.expression.type.operator.unary]),compile:function(t,i,r){delete t.match,t.value=t.value.trim();var n=t.value,s=e.expression.operator.lookup(n,t);for(e.log.trace("Twig.expression.compile: ","Operator: ",s," from ",n);i.length>0&&(i[i.length-1].type==e.expression.type.operator.unary||i[i.length-1].type==e.expression.type.operator.binary)&&(s.associativity===e.expression.operator.leftToRight&&s.precidence>=i[i.length-1].precidence||s.associativity===e.expression.operator.rightToLeft&&s.precidence>i[i.length-1].precidence);){var o=i.pop();r.push(o)}if(":"===n){if(!i[i.length-1]||"?"!==i[i.length-1].value){var a=r.pop();if(a.type===e.expression.type.string||a.type===e.expression.type.variable)t.key=a.value;else if(a.type===e.expression.type.number)t.key=a.value.toString();else{if(a.type!==e.expression.type.parameter.end||!a.expression)throw new e.Error("Unexpected value before ':' of "+a.type+" = "+a.value);t.params=a.params}return void r.push(t)}}else i.push(s)},parse:function(t,i,r){t.key?i.push(t):t.params?(t.key=e.expression.parse.apply(this,[t.params,r]),i.push(t),delete t.params):e.expression.operator.parse(t.value,i)}},{type:e.expression.type.operator.unary,regex:/(^not\s+)/,next:e.expression.set.expressions,compile:function(t,i,r){delete t.match,t.value=t.value.trim();var n=t.value,s=e.expression.operator.lookup(n,t);for(e.log.trace("Twig.expression.compile: ","Operator: ",s," from ",n);i.length>0&&(i[i.length-1].type==e.expression.type.operator.unary||i[i.length-1].type==e.expression.type.operator.binary)&&(s.associativity===e.expression.operator.leftToRight&&s.precidence>=i[i.length-1].precidence||s.associativity===e.expression.operator.rightToLeft&&s.precidence>i[i.length-1].precidence);){var o=i.pop();r.push(o)}i.push(s)},parse:function(t,i,r){e.expression.operator.parse(t.value,i)}},{type:e.expression.type.string,regex:/^(["'])(?:(?=(\\?))\2[\s\S])*?\1/,next:e.expression.set.operations,compile:function(t,i,r){var n=t.value;delete t.match,n='"'===n.substring(0,1)?n.replace('\\"','"'):n.replace("\\'","'"),t.value=n.substring(1,n.length-1).replace(/\\n/g,"\n").replace(/\\r/g,"\r"),e.log.trace("Twig.expression.compile: ","String value: ",t.value),r.push(t)},parse:e.expression.fn.parse.push_value},{type:e.expression.type.parameter.start,regex:/^\(/,next:e.expression.set.expressions.concat([e.expression.type.parameter.end]),compile:e.expression.fn.compile.push_both,parse:e.expression.fn.parse.push},{type:e.expression.type.parameter.end,regex:/^\)/,next:e.expression.set.operations_extended,compile:function(t,i,r){var n,s=t;for(n=i.pop();i.length>0&&n.type!=e.expression.type.parameter.start;)r.push(n),n=i.pop();for(var o=[];t.type!==e.expression.type.parameter.start;)o.unshift(t),t=r.pop();o.unshift(t);void 0===(t=r[r.length-1])||t.type!==e.expression.type._function&&t.type!==e.expression.type.filter&&t.type!==e.expression.type.test&&t.type!==e.expression.type.key.brackets&&t.type!==e.expression.type.key.period?(s.expression=!0,o.pop(),o.shift(),s.params=o,r.push(s)):(s.expression=!1,t.params=o)},parse:function(t,i,r){var n=[],s=!1,o=null;if(t.expression)o=e.expression.parse.apply(this,[t.params,r]),i.push(o);else{for(;i.length>0;){if((o=i.pop())&&o.type&&o.type==e.expression.type.parameter.start){s=!0;break}n.unshift(o)}if(!s)throw new e.Error("Expected end of parameter set.");i.push(n)}}},{type:e.expression.type.array.start,regex:/^\[/,next:e.expression.set.expressions.concat([e.expression.type.array.end]),compile:e.expression.fn.compile.push_both,parse:e.expression.fn.parse.push},{type:e.expression.type.array.end,regex:/^\]/,next:e.expression.set.operations_extended,compile:function(t,i,r){for(var n,s=i.length-1;s>=0&&(n=i.pop()).type!==e.expression.type.array.start;s--)r.push(n);r.push(t)},parse:function(t,i,r){for(var n=[],s=!1,o=null;i.length>0;){if((o=i.pop()).type&&o.type==e.expression.type.array.start){s=!0;break}n.unshift(o)}if(!s)throw new e.Error("Expected end of array.");i.push(n)}},{type:e.expression.type.object.start,regex:/^\{/,next:e.expression.set.expressions.concat([e.expression.type.object.end]),compile:e.expression.fn.compile.push_both,parse:e.expression.fn.parse.push},{type:e.expression.type.object.end,regex:/^\}/,next:e.expression.set.operations_extended,compile:function(t,i,r){for(var n,s=i.length-1;s>=0&&(!(n=i.pop())||n.type!==e.expression.type.object.start);s--)r.push(n);r.push(t)},parse:function(t,i,r){for(var n={},s=!1,o=null,a=!1,p=null;i.length>0;){if((o=i.pop())&&o.type&&o.type===e.expression.type.object.start){s=!0;break}if(o&&o.type&&(o.type===e.expression.type.operator.binary||o.type===e.expression.type.operator.unary)&&o.key){if(!a)throw new e.Error("Missing value for key '"+o.key+"' in object definition.");n[o.key]=p,void 0===n._keys&&(n._keys=[]),n._keys.unshift(o.key),p=null,a=!1}else a=!0,p=o}if(!s)throw new e.Error("Unexpected end of object.");i.push(n)}},{type:e.expression.type.filter,regex:/^\|\s?([a-zA-Z_][a-zA-Z0-9_\-]*)/,next:e.expression.set.operations_extended.concat([e.expression.type.parameter.start]),compile:function(e,t,i){e.value=e.match[1],i.push(e)},parse:function(t,i,r){var n=i.pop(),s=t.params&&e.expression.parse.apply(this,[t.params,r]);i.push(e.filter.apply(this,[t.value,n,s]))}},{type:e.expression.type._function,regex:/^([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/,next:e.expression.type.parameter.start,transform:function(e,t){return"("},compile:function(e,t,i){var r=e.match[1];e.fn=r,delete e.match,delete e.value,i.push(e)},parse:function(t,i,r){var n,s=t.params&&e.expression.parse.apply(this,[t.params,r]),o=t.fn;if(e.functions[o])n=e.functions[o].apply(this,s);else{if("function"!=typeof r[o])throw new e.Error(o+" function does not exist and is not defined in the context");n=r[o].apply(r,s)}i.push(n)}},{type:e.expression.type.variable,regex:/^[a-zA-Z_][a-zA-Z0-9_]*/,next:e.expression.set.operations_extended.concat([e.expression.type.parameter.start]),compile:e.expression.fn.compile.push,validate:function(t,i){return e.indexOf(e.expression.reservedWords,t[0])<0},parse:function(t,i,r){var n=e.expression.resolve(r[t.value],r);i.push(n)}},{type:e.expression.type.key.period,regex:/^\.([a-zA-Z0-9_]+)/,next:e.expression.set.operations_extended.concat([e.expression.type.parameter.start]),compile:function(e,t,i){e.key=e.match[1],delete e.match,delete e.value,i.push(e)},parse:function(t,i,r){var n,s=t.params&&e.expression.parse.apply(this,[t.params,r]),o=t.key,a=i.pop();if(null==a){if(this.options.strict_variables)throw new e.Error("Can't access a key "+o+" on an null or undefined object.");return null}var p=function(e){return e.substr(0,1).toUpperCase()+e.substr(1)};n="object"==typeof a&&o in a?a[o]:void 0!==a["get"+p(o)]?a["get"+p(o)]:void 0!==a["is"+p(o)]?a["is"+p(o)]:void 0,i.push(e.expression.resolve(n,a,s))}},{type:e.expression.type.key.brackets,regex:/^\[([^\]]*)\]/,next:e.expression.set.operations_extended.concat([e.expression.type.parameter.start]),compile:function(t,i,r){var n=t.match[1];delete t.value,delete t.match,t.stack=e.expression.compile({value:n}).stack,r.push(t)},parse:function(t,i,r){var n,s=t.params&&e.expression.parse.apply(this,[t.params,r]),o=e.expression.parse.apply(this,[t.stack,r]),a=i.pop();if(null==a){if(this.options.strict_variables)throw new e.Error("Can't access a key "+o+" on an null or undefined object.");return null}n="object"==typeof a&&o in a?a[o]:null,i.push(e.expression.resolve(n,a,s))}},{type:e.expression.type._null,regex:/^(null|NULL|none|NONE)/,next:e.expression.set.operations,compile:function(e,t,i){delete e.match,e.value=null,i.push(e)},parse:e.expression.fn.parse.push_value},{type:e.expression.type.context,regex:/^_context/,next:e.expression.set.operations_extended.concat([e.expression.type.parameter.start]),compile:e.expression.fn.compile.push,parse:function(e,t,i){t.push(i)}},{type:e.expression.type.number,regex:/^\-?\d+(\.\d+)?/,next:e.expression.set.operations,compile:function(e,t,i){e.value=Number(e.value),i.push(e)},parse:e.expression.fn.parse.push_value},{type:e.expression.type.bool,regex:/^(true|TRUE|false|FALSE)/,next:e.expression.set.operations,compile:function(e,t,i){e.value="true"===e.match[0].toLowerCase(),delete e.match,i.push(e)},parse:e.expression.fn.parse.push_value}],e.expression.resolve=function(e,t,i){return"function"==typeof e?e.apply(t,i||[]):e},e.expression.handler={},e.expression.extendType=function(t){e.expression.type[t]="Twig.expression.type."+t},e.expression.extend=function(t){if(!t.type)throw new e.Error("Unable to extend logic definition. No type provided for "+t);e.expression.handler[t.type]=t};e.expression.definitions.length>0;)e.expression.extend(e.expression.definitions.shift());return e.expression.tokenize=function(t){var i,r,n,s,o,a,p=[],l=0,c=null,u=[];for(a=function(){var t=Array.prototype.slice.apply(arguments);t.pop(),t.pop();return e.log.trace("Twig.expression.tokenize","Matched a ",i," regular expression of ",t),c&&e.indexOf(c,i)<0?(u.push(i+" cannot follow a "+p[p.length-1].type+" at template:"+l+" near '"+t[0].substring(0,20)+"...'"),t[0]):e.expression.handler[i].validate&&!e.expression.handler[i].validate(t,p)?t[0]:(u=[],p.push({type:i,value:t[0],match:t}),o=!0,c=s,l+=t[0].length,e.expression.handler[i].transform?e.expression.handler[i].transform(t,p):"")},e.log.debug("Twig.expression.tokenize","Tokenizing expression ",t);t.length>0;){for(i in t=t.trim(),e.expression.handler)if(e.expression.handler.hasOwnProperty(i)){for(s=e.expression.handler[i].next,n=(r=e.expression.handler[i].regex)instanceof Array?r:[r],o=!1;n.length>0;)r=n.pop(),t=t.replace(r,a);if(o)break}if(!o)throw u.length>0?new e.Error(u.join(" OR ")):new e.Error("Unable to parse '"+t+"' at template position"+l)}return e.log.trace("Twig.expression.tokenize","Tokenized to ",p),p},e.expression.compile=function(t){var i=t.value,r=e.expression.tokenize(i),n=null,s=[],o=[],a=null;for(e.log.trace("Twig.expression.compile: ","Compiling ",i);r.length>0;)n=r.shift(),a=e.expression.handler[n.type],e.log.trace("Twig.expression.compile: ","Compiling ",n),a.compile&&a.compile(n,o,s),e.log.trace("Twig.expression.compile: ","Stack is",o),e.log.trace("Twig.expression.compile: ","Output is",s);for(;o.length>0;)s.push(o.pop());return e.log.trace("Twig.expression.compile: ","Final output is",s),t.stack=s,delete t.value,t},e.expression.parse=function(t,i){var r=this;t instanceof Array||(t=[t]);var n=[],s=null;return e.forEach(t,(function(t){(s=e.expression.handler[t.type]).parse&&s.parse.apply(r,[t,n,i])})),n.pop()},e}((Twig=function(e){"use strict";for(e.logic={},e.logic.type={if_:"Twig.logic.type.if",endif:"Twig.logic.type.endif",for_:"Twig.logic.type.for",endfor:"Twig.logic.type.endfor",else_:"Twig.logic.type.else",elseif:"Twig.logic.type.elseif",set:"Twig.logic.type.set",setcapture:"Twig.logic.type.setcapture",endset:"Twig.logic.type.endset",filter:"Twig.logic.type.filter",endfilter:"Twig.logic.type.endfilter",shortblock:"Twig.logic.type.shortblock",block:"Twig.logic.type.block",endblock:"Twig.logic.type.endblock",extends_:"Twig.logic.type.extends",use:"Twig.logic.type.use",include:"Twig.logic.type.include",spaceless:"Twig.logic.type.spaceless",endspaceless:"Twig.logic.type.endspaceless",macro:"Twig.logic.type.macro",endmacro:"Twig.logic.type.endmacro",import_:"Twig.logic.type.import",from:"Twig.logic.type.from",embed:"Twig.logic.type.embed",endembed:"Twig.logic.type.endembed"},e.logic.definitions=[{type:e.logic.type.if_,regex:/^if\s+([\s\S]+)$/,next:[e.logic.type.else_,e.logic.type.elseif,e.logic.type.endif],open:!0,compile:function(t){var i=t.match[1];return t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,delete t.match,t},parse:function(t,i,r){var n="";return r=!0,e.expression.parse.apply(this,[t.stack,i])&&(r=!1,n=e.parse.apply(this,[t.output,i])),{chain:r,output:n}}},{type:e.logic.type.elseif,regex:/^elseif\s+([^\s].*)$/,next:[e.logic.type.else_,e.logic.type.elseif,e.logic.type.endif],open:!1,compile:function(t){var i=t.match[1];return t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,delete t.match,t},parse:function(t,i,r){var n="";return r&&!0===e.expression.parse.apply(this,[t.stack,i])&&(r=!1,n=e.parse.apply(this,[t.output,i])),{chain:r,output:n}}},{type:e.logic.type.else_,regex:/^else$/,next:[e.logic.type.endif,e.logic.type.endfor],open:!1,parse:function(t,i,r){var n="";return r&&(n=e.parse.apply(this,[t.output,i])),{chain:r,output:n}}},{type:e.logic.type.endif,regex:/^endif$/,next:[],open:!1},{type:e.logic.type.for_,regex:/^for\s+([a-zA-Z0-9_,\s]+)\s+in\s+([^\s].*?)(?:\s+if\s+([^\s].*))?$/,next:[e.logic.type.else_,e.logic.type.endfor],open:!0,compile:function(t){var i=t.match[1],r=t.match[2],n=t.match[3],s=null;if(t.key_var=null,t.value_var=null,i.indexOf(",")>=0){if(2!==(s=i.split(",")).length)throw new e.Error("Invalid expression in for loop: "+i);t.key_var=s[0].trim(),t.value_var=s[1].trim()}else t.value_var=i;return t.expression=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:r}]).stack,n&&(t.conditional=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:n}]).stack),delete t.match,t},parse:function(t,i,r){var n,s,o=e.expression.parse.apply(this,[t.expression,i]),a=[],p=0,l=this,c=t.conditional,u=function(r,s){var o=e.ChildContext(i);o[t.value_var]=s,t.key_var&&(o[t.key_var]=r),o.loop=function(e,t){var r=void 0!==c;return{index:e+1,index0:e,revindex:r?void 0:t-e,revindex0:r?void 0:t-e-1,first:0===e,last:r?void 0:e===t-1,length:r?void 0:t,parent:i}}(p,n),(void 0===c||e.expression.parse.apply(l,[c,o]))&&(a.push(e.parse.apply(l,[t.output,o])),p+=1),delete o.loop,delete o[t.value_var],delete o[t.key_var],e.merge(i,o,!0)};return e.lib.is("Array",o)?(n=o.length,e.forEach(o,(function(e){u(p,e)}))):e.lib.is("Object",o)&&(s=void 0!==o._keys?o._keys:Object.keys(o),n=s.length,e.forEach(s,(function(e){"_keys"!==e&&u(e,o[e])}))),{chain:0===a.length,output:e.output.apply(this,[a])}}},{type:e.logic.type.endfor,regex:/^endfor$/,next:[],open:!1},{type:e.logic.type.set,regex:/^set\s+([a-zA-Z0-9_,\s]+)\s*=\s*([\s\S]+)$/,next:[],open:!0,compile:function(t){var i=t.match[1].trim(),r=t.match[2],n=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:r}]).stack;return t.key=i,t.expression=n,delete t.match,t},parse:function(t,i,r){var n=e.expression.parse.apply(this,[t.expression,i]);return i[t.key]=n,{chain:r,context:i}}},{type:e.logic.type.setcapture,regex:/^set\s+([a-zA-Z0-9_,\s]+)$/,next:[e.logic.type.endset],open:!0,compile:function(e){var t=e.match[1].trim();return e.key=t,delete e.match,e},parse:function(t,i,r){var n=e.parse.apply(this,[t.output,i]),s=t.key;return this.context[s]=n,i[s]=n,{chain:r,context:i}}},{type:e.logic.type.endset,regex:/^endset$/,next:[],open:!1},{type:e.logic.type.filter,regex:/^filter\s+(.+)$/,next:[e.logic.type.endfilter],open:!0,compile:function(t){var i="|"+t.match[1].trim();return t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,delete t.match,t},parse:function(t,i,r){var n=e.parse.apply(this,[t.output,i]),s=[{type:e.expression.type.string,value:n}].concat(t.stack);return{chain:r,output:e.expression.parse.apply(this,[s,i])}}},{type:e.logic.type.endfilter,regex:/^endfilter$/,next:[],open:!1},{type:e.logic.type.block,regex:/^block\s+([a-zA-Z0-9_]+)$/,next:[e.logic.type.endblock],open:!0,compile:function(e){return e.block=e.match[1].trim(),delete e.match,e},parse:function(t,i,r){var n,s=e.indexOf(this.importedBlocks,t.block)>-1,o=this.blocks[t.block]&&e.indexOf(this.blocks[t.block],e.placeholders.parent)>-1;return(void 0===this.blocks[t.block]||s||o||i.loop||t.overwrite)&&(n=t.expression?e.expression.parse.apply(this,[{type:e.expression.type.string,value:e.expression.parse.apply(this,[t.output,i])},i]):e.expression.parse.apply(this,[{type:e.expression.type.string,value:e.parse.apply(this,[t.output,i])},i]),s&&this.importedBlocks.splice(this.importedBlocks.indexOf(t.block),1),this.blocks[t.block]=o?e.Markup(this.blocks[t.block].replace(e.placeholders.parent,n)):n,this.originalBlockTokens[t.block]={type:t.type,block:t.block,output:t.output,overwrite:!0}),{chain:r,output:this.child.blocks[t.block]?this.child.blocks[t.block]:this.blocks[t.block]}}},{type:e.logic.type.shortblock,regex:/^block\s+([a-zA-Z0-9_]+)\s+(.+)$/,next:[],open:!0,compile:function(t){return t.expression=t.match[2].trim(),t.output=e.expression.compile({type:e.expression.type.expression,value:t.expression}).stack,t.block=t.match[1].trim(),delete t.match,t},parse:function(t,i,r){return e.logic.handler[e.logic.type.block].parse.apply(this,arguments)}},{type:e.logic.type.endblock,regex:/^endblock(?:\s+([a-zA-Z0-9_]+))?$/,next:[],open:!1},{type:e.logic.type.extends_,regex:/^extends\s+(.+)$/,next:[],open:!0,compile:function(t){var i=t.match[1].trim();return delete t.match,t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,t},parse:function(t,i,r){var n=e.expression.parse.apply(this,[t.stack,i]);return this.extend=n,{chain:r,output:""}}},{type:e.logic.type.use,regex:/^use\s+(.+)$/,next:[],open:!0,compile:function(t){var i=t.match[1].trim();return delete t.match,t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,t},parse:function(t,i,r){var n=e.expression.parse.apply(this,[t.stack,i]);return this.importBlocks(n),{chain:r,output:""}}},{type:e.logic.type.include,regex:/^include\s+(ignore missing\s+)?(.+?)\s*(?:with\s+([\S\s]+?))?\s*(only)?$/,next:[],open:!0,compile:function(t){var i=t.match,r=void 0!==i[1],n=i[2].trim(),s=i[3],o=void 0!==i[4]&&i[4].length;return delete t.match,t.only=o,t.includeMissing=r,t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:n}]).stack,void 0!==s&&(t.withStack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:s.trim()}]).stack),t},parse:function(t,i,r){var n,s,o={};if(t.only||(o=e.ChildContext(i)),void 0!==t.withStack)for(s in n=e.expression.parse.apply(this,[t.withStack,i]))n.hasOwnProperty(s)&&(o[s]=n[s]);var a=e.expression.parse.apply(this,[t.stack,o]);return{chain:r,output:(a instanceof e.Template?a:this.importFile(a)).render(o)}}},{type:e.logic.type.spaceless,regex:/^spaceless$/,next:[e.logic.type.endspaceless],open:!0,parse:function(t,i,r){return{chain:r,output:e.parse.apply(this,[t.output,i]).replace(/>\s+</g,"><").trim()}}},{type:e.logic.type.endspaceless,regex:/^endspaceless$/,next:[],open:!1},{type:e.logic.type.macro,regex:/^macro\s+([a-zA-Z0-9_]+)\s*\(\s*((?:[a-zA-Z0-9_]+(?:,\s*)?)*)\s*\)$/,next:[e.logic.type.endmacro],open:!0,compile:function(t){for(var i=t.match[1],r=t.match[2].split(/[\s,]+/),n=0;n<r.length;n++)for(var s=0;s<r.length;s++)if(r[n]===r[s]&&n!==s)throw new e.Error("Duplicate arguments for parameter: "+r[n]);return t.macroName=i,t.parameters=r,delete t.match,t},parse:function(t,i,r){var n=this;return this.macros[t.macroName]=function(){for(var i={_self:n.macros},r=0;r<t.parameters.length;r++){var s=t.parameters[r];void 0!==arguments[r]?i[s]=arguments[r]:i[s]=void 0}return e.parse.apply(n,[t.output,i])},{chain:r,output:""}}},{type:e.logic.type.endmacro,regex:/^endmacro$/,next:[],open:!1},{type:e.logic.type.import_,regex:/^import\s+(.+)\s+as\s+([a-zA-Z0-9_]+)$/,next:[],open:!0,compile:function(t){var i=t.match[1].trim(),r=t.match[2].trim();return delete t.match,t.expression=i,t.contextName=r,t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,t},parse:function(t,i,r){if("_self"!==t.expression){var n=e.expression.parse.apply(this,[t.stack,i]),s=this.importFile(n||t.expression);i[t.contextName]=s.render({},{output:"macros"})}else i[t.contextName]=this.macros;return{chain:r,output:""}}},{type:e.logic.type.from,regex:/^from\s+(.+)\s+import\s+([a-zA-Z0-9_, ]+)$/,next:[],open:!0,compile:function(t){for(var i=t.match[1].trim(),r=t.match[2].trim().split(/[ ,]+/),n={},s=0;s<r.length;s++){var o=r[s],a=o.match(/^([a-zA-Z0-9_]+)\s+(.+)\s+as\s+([a-zA-Z0-9_]+)$/);a?n[a[1].trim()]=a[2].trim():o.match(/^([a-zA-Z0-9_]+)$/)&&(n[o]=o)}return delete t.match,t.expression=i,t.macroNames=n,t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:i}]).stack,t},parse:function(t,i,r){var n;if("_self"!==t.expression){var s=e.expression.parse.apply(this,[t.stack,i]);n=this.importFile(s||t.expression).render({},{output:"macros"})}else n=this.macros;for(var o in t.macroNames)n.hasOwnProperty(o)&&(i[t.macroNames[o]]=n[o]);return{chain:r,output:""}}},{type:e.logic.type.embed,regex:/^embed\s+(ignore missing\s+)?(.+?)\s*(?:with\s+(.+?))?\s*(only)?$/,next:[e.logic.type.endembed],open:!0,compile:function(t){var i=t.match,r=void 0!==i[1],n=i[2].trim(),s=i[3],o=void 0!==i[4]&&i[4].length;return delete t.match,t.only=o,t.includeMissing=r,t.stack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:n}]).stack,void 0!==s&&(t.withStack=e.expression.compile.apply(this,[{type:e.expression.type.expression,value:s.trim()}]).stack),t},parse:function(t,i,r){var n,s,o,a={};if(!t.only)for(s in i)i.hasOwnProperty(s)&&(a[s]=i[s]);if(void 0!==t.withStack)for(s in n=e.expression.parse.apply(this,[t.withStack,i]))n.hasOwnProperty(s)&&(a[s]=n[s]);var p=e.expression.parse.apply(this,[t.stack,a]);o=p instanceof e.Template?p:this.importFile(p),this.blocks={};e.parse.apply(this,[t.output,a]);return{chain:r,output:o.render(a,{blocks:this.blocks})}}},{type:e.logic.type.endembed,regex:/^endembed$/,next:[],open:!1}],e.logic.handler={},e.logic.extendType=function(t,i){i=i||"Twig.logic.type"+t,e.logic.type[t]=i},e.logic.extend=function(t){if(!t.type)throw new e.Error("Unable to extend logic definition. No type provided for "+t);e.logic.extendType(t.type),e.logic.handler[t.type]=t};e.logic.definitions.length>0;)e.logic.extend(e.logic.definitions.shift());return e.logic.compile=function(t){var i=t.value.trim(),r=e.logic.tokenize.apply(this,[i]),n=e.logic.handler[r.type];return n.compile&&(r=n.compile.apply(this,[r]),e.log.trace("Twig.logic.compile: ","Compiled logic token to ",r)),r},e.logic.tokenize=function(t){var i={},r=null,n=null,s=null,o=null,a=null;for(r in t=t.trim(),e.logic.handler)if(e.logic.handler.hasOwnProperty(r))for(n=e.logic.handler[r].type,o=[],(s=e.logic.handler[r].regex)instanceof Array?o=s:o.push(s);o.length>0;)if(null!==(a=o.shift().exec(t.trim())))return i.type=n,i.match=a,e.log.trace("Twig.logic.tokenize: ","Matched a ",n," regular expression of ",a),i;throw new e.Error("Unable to parse '"+t.trim()+"'")},e.logic.parse=function(t,i,r){var n,s="";return i=i||{},e.log.debug("Twig.logic.parse: ","Parsing logic token ",t),(n=e.logic.handler[t.type]).parse&&(s=n.parse.apply(this,[t,i,r])),s},e}((Twig=function(e){e.lib={};var t=function(){var e={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};function t(){var e=arguments[0],i=t.cache;return i[e]&&i.hasOwnProperty(e)||(i[e]=t.parse(e)),t.format.call(null,i[e],arguments)}t.format=function(r,n){var s,o,a,p,l,c,u,d,m=1,h=r.length,g="",f=[],y=!0,v="";for(o=0;o<h;o++)if("string"===(g=i(r[o])))f[f.length]=r[o];else if("array"===g){if((p=r[o])[2])for(s=n[m],a=0;a<p[2].length;a++){if(!s.hasOwnProperty(p[2][a]))throw new Error(t("[sprintf] property '%s' does not exist",p[2][a]));s=s[p[2][a]]}else s=p[1]?n[p[1]]:n[m++];if("function"==i(s)&&(s=s()),e.not_string.test(p[8])&&e.not_json.test(p[8])&&"number"!=i(s)&&isNaN(s))throw new TypeError(t("[sprintf] expecting number but found %s",i(s)));switch(e.number.test(p[8])&&(y=s>=0),p[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":case"i":s=parseInt(s,10);break;case"j":s=JSON.stringify(s,null,p[6]?parseInt(p[6]):0);break;case"e":s=p[7]?s.toExponential(p[7]):s.toExponential();break;case"f":s=p[7]?parseFloat(s).toFixed(p[7]):parseFloat(s);break;case"g":s=p[7]?parseFloat(s).toPrecision(p[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=String(s))&&p[7]?s.substring(0,p[7]):s;break;case"u":s>>>=0;break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}e.json.test(p[8])?f[f.length]=s:(!e.number.test(p[8])||y&&!p[3]?v="":(v=y?"+":"-",s=s.toString().replace(e.sign,"")),c=p[4]?"0"===p[4]?"0":p[4].charAt(1):" ",u=p[6]-(v+s).length,l=p[6]&&u>0?(d=c,Array(u+1).join(d)):"",f[f.length]=p[5]?v+s+l:"0"===c?v+l+s:l+v+s)}return f.join("")},t.cache={},t.parse=function(t){for(var i=t,r=[],n=[],s=0;i;){if(null!==(r=e.text.exec(i)))n[n.length]=r[0];else if(null!==(r=e.modulo.exec(i)))n[n.length]="%";else{if(null===(r=e.placeholder.exec(i)))throw new SyntaxError("[sprintf] unexpected placeholder");if(r[2]){s|=1;var o=[],a=r[2],p=[];if(null===(p=e.key.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o[o.length]=p[1];""!==(a=a.substring(p[0].length));)if(null!==(p=e.key_access.exec(a)))o[o.length]=p[1];else{if(null===(p=e.index_access.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");o[o.length]=p[1]}r[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n[n.length]=r}i=i.substring(r[0].length)}return n};function i(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}return{sprintf:t,vsprintf:function(e,i,r){return(r=(i||[]).slice(0)).splice(0,0,e),t.apply(null,r)}}}(),i=t.sprintf,r=t.vsprintf;return e.lib.sprintf=i,e.lib.vsprintf=r,function(){var t="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),i="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),r="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),n="January,February,March,April,May,June,July,August,September,October,November,December".split(",");function s(e){var t=new Date(e.getFullYear()+1,0,4);return(t-e)/864e5<7&&(e.getDay()+6)%7<(t.getDay()+6)%7?t.getFullYear():e.getMonth()>0||e.getDate()>=4?e.getFullYear():e.getFullYear()-((e.getDay()+6)%7-e.getDate()>2?1:0)}e.lib.formatDate=function(e,o){if("string"!=typeof o||/^\s*$/.test(o))return e+"";var a=new Date(e.getFullYear(),0,1),p=e;return o.replace(/[dDjlNSwzWFmMntLoYyaABgGhHisuU]/g,(function(e){switch(e){case"d":return("0"+p.getDate()).replace(/^.+(..)$/,"$1");case"D":return t[p.getDay()];case"j":return p.getDate();case"l":return i[p.getDay()];case"N":return(p.getDay()+6)%7+1;case"S":return c=p.getDate(),(c=Math.abs(c)%100)%10==1&&11!=c?"st":c%10==2&&12!=c?"nd":c%10==3&&13!=c?"rd":"th";case"w":return p.getDay();case"z":return Math.ceil((a-p)/864e5);case"W":return("0"+(o=p,l=new Date(s(o),0,4),l.setDate(l.getDate()-(l.getDay()+6)%7),parseInt((o-l)/6048e5)+1)).replace(/^.(..)$/,"$1");case"F":return n[p.getMonth()];case"m":return("0"+(p.getMonth()+1)).replace(/^.+(..)$/,"$1");case"M":return r[p.getMonth()];case"n":return p.getMonth()+1;case"t":return new Date(p.getFullYear(),p.getMonth()+1,-1).getDate();case"L":return 29==new Date(p.getFullYear(),1,29).getDate()?1:0;case"o":return s(p);case"Y":return p.getFullYear();case"y":return(p.getFullYear()+"").replace(/^.+(..)$/,"$1");case"a":return p.getHours()<12?"am":"pm";case"A":return p.getHours()<12?"AM":"PM";case"B":return Math.floor(1e3*((p.getUTCHours()+1)%24+p.getUTCMinutes()/60+p.getUTCSeconds()/3600)/24);case"g":return p.getHours()%12!=0?p.getHours()%12:12;case"G":return p.getHours();case"h":return("0"+(p.getHours()%12!=0?p.getHours()%12:12)).replace(/^.+(..)$/,"$1");case"H":return("0"+p.getHours()).replace(/^.+(..)$/,"$1");case"i":return("0"+p.getMinutes()).replace(/^.+(..)$/,"$1");case"s":return("0"+p.getSeconds()).replace(/^.+(..)$/,"$1");case"u":return p.getMilliseconds();case"U":return p.getTime()/1e3}var o,l,c}))}}(),e.lib.strip_tags=function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(e,i){return t.indexOf("<"+i.toLowerCase()+">")>-1?e:""}))},e.lib.parseISO8601Date=function(e){var t=[];if(!(t=e.match(/(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d):(\d\d))/)))throw"Couldn't parse ISO 8601 date string '"+e+"'";var i=[1,2,3,4,5,6,10,11];for(var r in i)t[i[r]]=parseInt(t[i[r]],10);t[7]=parseFloat(t[7]);var n=Date.UTC(t[1],t[2]-1,t[3],t[4],t[5],t[6]);if(t[7]>0&&(n+=Math.round(1e3*t[7])),"Z"!=t[8]&&t[10]){var s=60*t[10]*60*1e3;t[11]&&(s+=60*t[11]*1e3),"-"==t[9]?n-=s:n+=s}return new Date(n)},e.lib.strtotime=function(e,t){var i,r,n,s,o,a,p,l,c,u;if(!e)return!1;if((r=(e=e.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase()).match(/^(\d{1,4})([\-\.\/\:])(\d{1,2})([\-\.\/\:])(\d{1,4})(?:\s(\d{1,2}):(\d{2})?:?(\d{2})?)?(?:\s([A-Z]+)?)?$/))&&r[2]===r[4])if(r[1]>1901)switch(r[2]){case"-":return!(r[3]>12||r[5]>31)&&new Date(r[1],parseInt(r[3],10)-1,r[5],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3;case".":return!1;case"/":return!(r[3]>12||r[5]>31)&&new Date(r[1],parseInt(r[3],10)-1,r[5],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3}else if(r[5]>1901)switch(r[2]){case"-":case".":return!(r[3]>12||r[1]>31)&&new Date(r[5],parseInt(r[3],10)-1,r[1],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3;case"/":return!(r[1]>12||r[3]>31)&&new Date(r[5],parseInt(r[1],10)-1,r[3],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3}else switch(r[2]){case"-":return!(r[3]>12||r[5]>31||r[1]<70&&r[1]>38)&&(s=r[1]>=0&&r[1]<=38?+r[1]+2e3:r[1],new Date(s,parseInt(r[3],10)-1,r[5],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3);case".":return r[5]>=70?!(r[3]>12||r[1]>31)&&new Date(r[5],parseInt(r[3],10)-1,r[1],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3:r[5]<60&&!r[6]&&(!(r[1]>23||r[3]>59)&&(n=new Date,new Date(n.getFullYear(),n.getMonth(),n.getDate(),r[1]||0,r[3]||0,r[5]||0,r[9]||0)/1e3));case"/":return!(r[1]>12||r[3]>31||r[5]<70&&r[5]>38)&&(s=r[5]>=0&&r[5]<=38?+r[5]+2e3:r[5],new Date(s,parseInt(r[1],10)-1,r[3],r[6]||0,r[7]||0,r[8]||0,r[9]||0)/1e3);case":":return!(r[1]>23||r[3]>59||r[5]>59)&&(n=new Date,new Date(n.getFullYear(),n.getMonth(),n.getDate(),r[1]||0,r[3]||0,r[5]||0)/1e3)}if("now"===e)return null===t||isNaN(t)?(new Date).getTime()/1e3|0:0|t;if(!isNaN(i=Date.parse(e)))return i/1e3|0;if((r=e.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2})[ t]([0-9]{2}:[0-9]{2}:[0-9]{2}(\.[0-9]+)?)([\+-][0-9]{2}(:[0-9]{2})?|z)/))&&("z"==r[4]?r[4]="Z":r[4].match(/^([\+-][0-9]{2})$/)&&(r[4]=r[4]+":00"),!isNaN(i=Date.parse(r[1]+"T"+r[2]+r[4]))))return i/1e3|0;function d(e){var t=e.split(" "),i=t[0],r=t[1].substring(0,3),n=/\d+/.test(i),s=("last"===i?-1:1)*("ago"===t[2]?-1:1);if(n&&(s*=parseInt(i,10)),p.hasOwnProperty(r)&&!t[1].match(/^mon(day|\.)?$/i))return o["set"+p[r]](o["get"+p[r]]()+s);if("wee"===r)return o.setDate(o.getDate()+7*s);if("next"===i||"last"===i)!function(e,t,i){var r,n=a[t];void 0!==n&&(0===(r=n-o.getDay())?r=7*i:r>0&&"last"===e?r-=7:r<0&&"next"===e&&(r+=7),o.setDate(o.getDate()+r))}(i,r,s);else if(!n)return!1;return!0}if(o=t?new Date(1e3*t):new Date,a={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},p={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},"([+-]?\\d+\\s"+(c="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)")+"|(last|next)\\s"+c+")(\\sago)?",!(r=e.match(new RegExp("([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)|(last|next)\\s(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?))(\\sago)?","gi"))))return!1;for(u=0,l=r.length;u<l;u++)if(!d(r[u]))return!1;return o.getTime()/1e3},e.lib.is=function(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&i===e},e.lib.copy=function(e){var t,i={};for(t in e)i[t]=e[t];return i},e.lib.replaceAll=function(e,t,i){return e.split(t).join(i)},e.lib.chunkArray=function(t,i){var r=[],n=0,s=t.length;if(i<1||!e.lib.is("Array",t))return[];for(;n<s;)r.push(t.slice(n,n+=i));return r},e.lib.round=function(e,t,i){var r,n,s,o;if(t|=0,s=(e*=r=Math.pow(10,t))%1==.5*(o=e>0|-(e<0)),n=Math.floor(e),s)switch(i){case"PHP_ROUND_HALF_DOWN":e=n+(o<0);break;case"PHP_ROUND_HALF_EVEN":e=n+n%2*o;break;case"PHP_ROUND_HALF_ODD":e=n+!(n%2);break;default:e=n+(o>0)}return(s?e:Math.round(e))/r},e.lib.max=function(){var e,t,i=0,r=0,n=arguments,s=n.length,o=function(e){if("[object Array]"===Object.prototype.toString.call(e))return e;var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t},a=function(e,t){var i=0,r=0,n=0,s=0,p=0;if(e===t)return 0;if("object"==typeof e){if("object"==typeof t){if(e=o(e),t=o(t),p=e.length,(s=t.length)>p)return 1;if(s<p)return-1;for(i=0,r=p;i<r;++i){if(1==(n=a(e[i],t[i])))return 1;if(-1==n)return-1}return 0}return-1}return"object"==typeof t?1:isNaN(t)&&!isNaN(e)?0==e?0:e<0?1:-1:isNaN(e)&&!isNaN(t)?0==t?0:t>0?1:-1:t==e?0:t>e?1:-1};if(0===s)throw new Error("At least one value should be passed to max()");if(1===s){if("object"!=typeof n[0])throw new Error("Wrong parameter count for max()");if(0===(e=o(n[0])).length)throw new Error("Array must contain at least one element for max()")}else e=n;for(t=e[0],i=1,r=e.length;i<r;++i)1==a(t,e[i])&&(t=e[i]);return t},e.lib.min=function(){var e,t,i=0,r=0,n=arguments,s=n.length,o=function(e){if("[object Array]"===Object.prototype.toString.call(e))return e;var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t},a=function(e,t){var i=0,r=0,n=0,s=0,p=0;if(e===t)return 0;if("object"==typeof e){if("object"==typeof t){if(e=o(e),t=o(t),p=e.length,(s=t.length)>p)return 1;if(s<p)return-1;for(i=0,r=p;i<r;++i){if(1==(n=a(e[i],t[i])))return 1;if(-1==n)return-1}return 0}return-1}return"object"==typeof t?1:isNaN(t)&&!isNaN(e)?0==e?0:e<0?1:-1:isNaN(e)&&!isNaN(t)?0==t?0:t>0?1:-1:t==e?0:t>e?1:-1};if(0===s)throw new Error("At least one value should be passed to min()");if(1===s){if("object"!=typeof n[0])throw new Error("Wrong parameter count for min()");if(0===(e=o(n[0])).length)throw new Error("Array must contain at least one element for min()")}else e=n;for(t=e[0],i=1,r=e.length;i<r;++i)-1==a(t,e[i])&&(t=e[i]);return t},e}(Twig||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{});"undefined"!=typeof module&&module.declare?module.declare([],(function(e,t,i){for(key in Twig.exports)Twig.exports.hasOwnProperty(key)&&(t[key]=Twig.exports[key])})):"function"==typeof define&&define.amd?define((function(){return Twig.exports})):"undefined"!=typeof module&&module.exports?module.exports=Twig.exports:(window.twig=Twig.exports.twig,window.Twig=Twig.exports);var protocolAndDomainRE=/^(?:\w+:)?\/\/(\S+)$/,localhostDomainRE=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,nonLocalhostDomainRE=/^[^\s\.]+\.\S{2,}$/;function isUrl(e){if("string"!=typeof e)return!1;var t=e.match(protocolAndDomainRE);if(!t)return!1;var i=t[1];return!!i&&!(!localhostDomainRE.test(i)&&!nonLocalhostDomainRE.test(i))}(()=>{const e=e=>{Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=1024?(e.classList.remove("grid"),e.classList.add("enable")):(e.classList.add("grid"),e.classList.remove("enable"))};document.querySelectorAll(".overflow").forEach(t=>{e(t),window.addEventListener("resize",i=>{e(t)})})})(),(()=>{const e=document.querySelectorAll(".account .delete");e&&e.forEach(e=>{e.addEventListener("click",t=>{confirm("Do you really want to delete this story?")&&(window.location.href=e.dataset.href)})})})(),(()=>{let e=document.querySelectorAll(".comment-list .delete-comment");e&&e.forEach(e=>{e.addEventListener("click",t=>{const i=encodeURI(window.location.pathname),r=`/comments/delete?commentId=${encodeURI(e.dataset.id)}&returnTo=${i}`;confirm("Do you really want to delete this comment?")&&(window.location.href=r)})});let t=document.querySelectorAll(".comment-list .flag-comment");t&&t.forEach(e=>{e.addEventListener("click",t=>{const i=encodeURI(window.location.pathname),r=`/comments/flag?commentId=${encodeURI(e.dataset.id)}&returnTo=${i}`;confirm("Do you really want to flag this comment?")&&(window.location.href=r)})});let i=document.querySelector("#comment-form"),r=document.querySelectorAll(".comments .reply");if(r){const e=document.querySelector(".comments .reply.main-thread");r.forEach(t=>{t.addEventListener("click",r=>{let n=r.target.parentNode,s=n.dataset.commentId;t.classList.contains("main-thread")?(e.style.display="none",s=""):e.style.display="inline-block",i.querySelector("textarea[name=contents]").value="",i.querySelector("input[name=parentId]").value=s,n.appendChild(i)})})}})(),(()=>{const e=(e,t,i)=>{var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),document.cookie=`${e}=${t}; expires=${r.toGMTString()}`},t=document.querySelector(".darkmode-toggle");if(!(e=>{for(var t=e+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){for(var n=i[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null})("digg-darkmode")){const i=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e("digg-darkmode",i),"dark"==i&&(t.checked=!0,document.body.classList.add("darkmode"))}t&&t.addEventListener("click",i=>{t.checked?(document.body.classList.add("darkmode"),e("digg-darkmode","dark",365)):(document.body.classList.remove("darkmode"),e("digg-darkmode","light",365))});let i=document.querySelector(".main-navigation .main-navigation__secondary-search label"),r=document.querySelector(".main-navigation .main-navigation__secondary-search form");i&&i.addEventListener("click",e=>{Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=840?window.location.href="/search":(i.style.display="none",r.style.display="block",setTimeout(()=>{r.style.opacity=1,r.querySelector("input").focus()},20))});let n=document.querySelector(".main-navigation__primary-trigger"),s=document.querySelector(".main-navigation__primary-panel"),o=document.querySelector(".main-navigation__inactive-overlay");n&&s&&o&&(n.addEventListener("click",e=>{s.classList.contains("main-navigation__primary-panel--active")?p(!1):p(!0),e.preventDefault()}),window.addEventListener("click",(function(e){s&&s.classList.contains("main-navigation__primary-panel--active")&&(n===e.target||s===e.target||d(n,e.target)||d(s,e.target)||p(!1));let t=document.querySelector(".main-navigation .main-navigation__secondary-account-trigger"),i=document.querySelector(".main-navigation .main-navigation__secondary-account-menu");t&&i&&i.classList.contains("main-navigation__secondary-account-menu--active")&&(t===e.target||d(t,e.target)||d(i,e.target)||u(!1))})));let a=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);function p(e){let t=document.querySelector(".main-navigation__primary-trigger"),i=document.querySelector(".main-navigation__primary-panel"),r=document.querySelector(".main-navigation__inactive-overlay");t&&i&&r&&(e?(t.classList.add("main-navigation__primary-trigger--active"),i.classList.add("main-navigation__primary-panel--active"),r.classList.add("main-navigation__inactive-overlay--active")):(t.classList.remove("main-navigation__primary-trigger--active"),i.classList.remove("main-navigation__primary-panel--active"),r.classList.remove("main-navigation__inactive-overlay--active")))}document.onscroll=function(){let e=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);document.querySelectorAll(".main-navigation").forEach((function(t){e<=a||e<=0?t.classList.remove("main-navigation--hidden"):e>a&&(t.classList.add("main-navigation--hidden"),p(!1))})),a=e};let l=document.querySelector(".main-navigation .main-navigation__secondary-account-trigger"),c=document.querySelector(".main-navigation .main-navigation__secondary-account-menu");function u(e){let t=document.querySelector(".main-navigation .main-navigation__secondary-account-trigger"),i=document.querySelector(".main-navigation .main-navigation__secondary-account-menu"),r=document.querySelector(".main-navigation__inactive-overlay");i&&t&&(e?(i.classList.add("main-navigation__secondary-account-menu--active"),t.classList.add("main-navigation__secondary-account-trigger--active"),r.classList.add("main-navigation__inactive-overlay--active")):(i.classList.remove("main-navigation__secondary-account-menu--active"),t.classList.remove("main-navigation__secondary-account-trigger--active"),r.classList.remove("main-navigation__inactive-overlay--active")))}function d(e,t){for(var i=t.parentNode;null!=i;){if(i==e)return!0;i=i.parentNode}return!1}l&&c&&l.addEventListener("click",e=>{c.classList.contains("main-navigation__secondary-account-menu--active")?u(!1):u(!0),e.preventDefault()})})(),(()=>{document.querySelectorAll("figure.story-image-container").forEach(e=>{let t=e.querySelector("img.lazy-image-img");t&&t.dataset.src&&(t.src=t.dataset.src)});if(document.querySelector(".infinite-scroll-title")){let e=[],t=[],i=0;setTimeout(()=>{document.querySelectorAll("article.single-story").forEach(i=>{const r=i.getBoundingClientRect().top,n=i.getBoundingClientRect().bottom;e.push({title:i.dataset.title,slug:i.dataset.slug,top:r,bottom:n,isArticle:!0}),t.push({top:r,bottom:n})});let r=document.querySelector(".fp-featured-story");if(r){let n=r.getBoundingClientRect().top,s=r.getBoundingClientRect().bottom;e.push({title:"Digg - What the Internet is talking about right now",slug:"/",top:n,bottom:s,isArticle:!1}),t.push({top:n,bottom:s});let o=0;window.addEventListener("scroll",(function(r){let n=-1;if(n=o>window.pageYOffset?((e,t)=>{let i=-1;return t.forEach((function(t,r){e>=t.bottom-100&&e<=t.bottom+100&&(i=r)})),i})(window.pageYOffset,t):((e,t)=>{let i=-1;return t.forEach((function(t,r){e>=t.top-100&&e<=t.top+100&&(i=r)})),i})(window.pageYOffset,t),n>=0&&i!=n){let t=e[n];document.title=t.title,window.history.pushState("object or string","Page Title",t.slug),i=n}o=window.pageYOffset}))}},1e3)}})(),(()=>{document.querySelectorAll("figure.story-image-container").forEach(e=>{let t=e.querySelector("img.lazy-image-img");t&&t.dataset.src&&(t.src=t.dataset.src)});if(document.querySelector(".infinite-scroll-title")){let e=[],t=[],i=0;setTimeout(()=>{document.querySelectorAll("article.single-user-story").forEach(i=>{const r=i.getBoundingClientRect().top,n=i.getBoundingClientRect().bottom;e.push({title:i.dataset.title,slug:i.dataset.slug,top:r,bottom:n,isArticle:!0}),t.push({top:r,bottom:n})});let r=document.querySelector(".fp-featured-story");if(r){let n=r.getBoundingClientRect().top,s=r.getBoundingClientRect().bottom;e.push({title:"Digg - What the Internet is talking about right now",slug:"/",top:n,bottom:s,isArticle:!1}),t.push({top:n,bottom:s});let o=0;window.addEventListener("scroll",(function(r){let n=-1;if(n=o>window.pageYOffset?((e,t)=>{let i=-1;return t.forEach((function(t,r){e>=t.bottom-100&&e<=t.bottom+100&&(i=r)})),i})(window.pageYOffset,t):((e,t)=>{let i=-1;return t.forEach((function(t,r){e>=t.top-100&&e<=t.top+100&&(i=r)})),i})(window.pageYOffset,t),n>=0&&i!=n){let t=e[n];document.title=t.title,window.history.pushState("object or string","Page Title",t.slug),i=n}o=window.pageYOffset}))}},1e3)}})(),(()=>{if(document.querySelector(".wrapper.submit-link")){const e={setUri:(e,t)=>(e.uri=t,e),setFeaturedImageUri:(e,t)=>(e.featuredImageUri=t,e),setTitle:(e,t)=>(e.title=t,e),setKicker:(e,t)=>(e.kicker=t,e),setDescription:(e,t)=>(e.description=t,e),setValidating:(e,t)=>(e.validating=t,e),setFeaturedImageUploadProgress:(e,t)=>(e.featuredImageUploadProgress=t,e),setFeaturedImageCroppingStatus:(e,t)=>(e.featuredImageCroppingStatus=t,e),setFeaturedImageFinishedUploading:(e,t)=>(e.featuredImageFinishedUploading=t,e)},t={setUri(e,t){e.commit("setUri",t)},setTitle(e,t){e.commit("setTitle",t)},setKicker(e,t){e.commit("setKicker",t)},setDescription(e,t){e.commit("setDescription",t)},setValidating(e,t){e.commit("setValidating",t)},setFeaturedImageFileBlob(e,t){submitLinkFormProxy.saveFeaturedImage(r,t).then(t=>{let i=JSON.parse(t);i.hasOwnProperty("success")&&"1"===i.success?(e.commit("setFeaturedImageUri",i.embed.imageUrl),e.dispatch("setFeaturedImageCroppingStatus",!1)):console.log(t)}).catch(e=>{console.log(e)})},setFeaturedImageFile(e,t){submitLinkFormProxy.saveFeaturedImage(r,t).then(t=>{let i=JSON.parse(t);i.hasOwnProperty("success")&&"1"===i.success?(e.commit("setFeaturedImageUri",i.embed.imageUrl),e.dispatch("setFeaturedImageFinishedUploading",!0)):console.log(t)}).catch(e=>{console.log(e)})},setFeaturedImageUploadProgress(e,t){e.commit("setFeaturedImageUploadProgress",t)},setFeaturedImageCroppingStatus(e,t){e.commit("setFeaturedImageCroppingStatus",t)},setFeaturedImageFinishedUploading(e,t){e.commit("setFeaturedImageFinishedUploading",t)}};let i={uri:window.submittedLink.uri,title:window.submittedLink.title,kicker:window.submittedLink.kicker,description:window.submittedLink.description,featuredImageUri:window.submittedLink.featuredImageUri,featuredImageUploadProgress:-1,featuredImageCroppingStatus:!1,featuredImageFinishedUploading:!1,validating:!1,namespaceSlug:window.submittedLink.namespaceSlug,hashId:window.submittedLink.hashId},r=new FsmStore({actions:t,mutations:e,state:i});class n extends FsmComponent{constructor(){super({store:r,elements:{divWrapperSubmitLink:document.querySelector(".wrapper.submit-link"),divThankYou:document.querySelector(".submit-link .submit-link__thank-you"),divSubmitLinkForm:document.querySelector(".submit-link .submit-link-form"),divSubmitPreview:document.querySelector(".submit-link .submit-link-preview"),btnSubmit:document.querySelector(".submit-link .submit-link-form__btn"),inputTitle:document.querySelector(".submit-link .submit-link-form .submit-link-form__title"),inputUri:document.querySelector(".submit-link .submit-link-form .submit-link-form__url"),inputKicker:document.querySelector(".submit-link .submit-link-form .submit-link-form__kicker"),inputDescription:document.querySelector(".submit-link .submit-link-form .submit-link-form__description"),inputImageUri:document.querySelector("#submit-link-form__image-input-uri"),inputLinkId:document.querySelector("#submit-link-form__link-id"),previewTitle:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__title"),previewKicker:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__kicker"),previewDescription:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__description"),previewUri:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__metadata a"),previewImage:document.querySelector(".submit-link .submit-link-preview__picture-link img"),divImageDropArea:document.querySelector(".submit-link-form__image-drop-area"),inputStoryImage:document.querySelector("#submit-link-form__image-input"),imgImage:document.querySelector(".submit-link-form__image-wrap img"),divUploadProgress:document.querySelector(".submit-link-form__upload-progress"),aCropCommand:document.querySelector(".submit-link-form__crop-command"),aCropFinishCommand:document.querySelector(".submit-link-form__crop-finish-command"),aCropCancelCommand:document.querySelector(".submit-link-form__crop-cancel-command")}}),r.state.title.trim().length>0&&(this.elements.inputTitle.value=DiggUtils.stripHtml(r.state.title)),r.state.kicker.trim().length>0&&(this.elements.inputKicker.value=DiggUtils.stripHtml(r.state.kicker)),r.state.uri.trim().length>0&&(this.elements.inputUri.value=DiggUtils.stripHtml(r.state.uri)),r.state.description.trim().length>0&&(this.elements.inputDescription.value=DiggUtils.stripHtml(r.state.description)),this.elements.inputTitle&&this.elements.previewTitle&&this.elements.inputTitle.addEventListener("blur",e=>{if(this.elements.inputTitle.value.trim().length>0||r.validating){this.validateTitle();let e=DiggUtils.stripHtml(this.elements.inputTitle.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputTitle.placeholder)),r.dispatch("setTitle",e)}}),this.elements.inputUri&&this.elements.previewUri&&this.elements.inputUri.addEventListener("blur",e=>{if(this.elements.inputUri.value.trim().length>0||r.validating){this.validateUri();let e=DiggUtils.stripHtml(this.elements.inputUri.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputUri.placeholder.trim())),r.dispatch("setUri",e)}}),this.elements.inputKicker&&this.elements.previewKicker&&this.elements.inputKicker.addEventListener("blur",e=>{if(this.elements.inputKicker.value.trim().length>0||r.validating){this.validateKicker();let e=DiggUtils.stripHtml(this.elements.inputKicker.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputKicker.placeholder.trim())),r.dispatch("setKicker",e)}}),this.elements.inputDescription&&this.elements.previewDescription&&this.elements.inputDescription.addEventListener("blur",e=>{if(this.elements.inputDescription.value.trim().length>0||r.validating){this.validateDescription();let e=DiggUtils.stripHtml(this.elements.inputDescription.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputDescription.placeholder.trim())),r.dispatch("setDescription",e)}}),this.elements.aCropCancelCommand&&this.elements.aCropCancelCommand.addEventListener("click",e=>{r.dispatch("setFeaturedImageCroppingStatus",!1),""!==this.elements.imgImage.getAttribute("src")&&(this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.aCropCommand&&this.elements.aCropCommand.addEventListener("click",e=>{""!==this.elements.imgImage.getAttribute("src")&&this.initializeCropper(),e.preventDefault()}),this.elements.aCropFinishCommand&&this.elements.aCropFinishCommand.addEventListener("click",e=>{""!==this.elements.imgImage.getAttribute("src")&&(this.saveCroppedImage(),this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.inputStoryImage&&this.elements.inputStoryImage.addEventListener("change",()=>{this.handleFileUpload(this.elements.inputStoryImage.files[0])},!1),this.elements.divImageDropArea&&(this.elements.divImageDropArea.addEventListener("drop",e=>{if(!r.state.featuredImageCroppingStatus){this.elements.divImageDropArea.classList.remove("submit-link-form__image-drop-area--highlight");let t=e.dataTransfer.files;this.handleFileUpload(t[0])}e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragenter",e=>{r.state.featuredImageCroppingStatus||this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragover",e=>{r.state.featuredImageCroppingStatus||this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragleave",e=>{this.elements.divImageDropArea.classList.remove("submit-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1)),this.elements.divThankYou&&this.elements.divSubmitLinkForm&&this.elements.divSubmitPreview&&this.elements.btnSubmit&&this.elements.btnSubmit.addEventListener("click",e=>{r.dispatch("setValidating",!0),this.validateForm()&&(r.dispatch("setValidating",!1),this.elements.divSubmitLinkForm.style.display="none",this.elements.divSubmitPreview.style.display="none",this.elements.divThankYou.style.display="block",submitLinkFormProxy.saveSubmittedLink(r).then(e=>{}).catch(e=>{console.log(e)})),e.preventDefault()})}render(){r.state.featuredImageCroppingStatus?this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--cropping"):this.elements.divImageDropArea.classList.remove("submit-link-form__image-drop-area--cropping"),r.state.featuredImageFinishedUploading&&(r.dispatch("setFeaturedImageFinishedUploading",!1),this.initializeCropper()),r.state.featuredImageUploadProgress<=-1?this.elements.divUploadProgress.style.display="none":(this.elements.divUploadProgress.style.width=r.state.featuredImageUploadProgress+"%",this.elements.divUploadProgress.style.display="block"),r.state.featuredImageUri&&r.state.featuredImageUri.length>0&&(this.elements.imgImage.setAttribute("src",DiggUtils.stripHtml(r.state.featuredImageUri)),this.elements.inputImageUri.value=DiggUtils.stripHtml(r.state.featuredImageUri),this.elements.previewImage.setAttribute("src",DiggUtils.stripHtml(r.state.featuredImageUri)),this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--has-image")),r.state.title.trim().length>0?this.elements.previewTitle.innerHTML=DiggUtils.stripHtml(r.state.title):this.elements.previewTitle.innerHTML=DiggUtils.stripHtml(this.elements.inputTitle.placeholder),r.state.kicker.trim().length>0?this.elements.previewKicker.innerHTML=DiggUtils.stripHtml(r.state.kicker):this.elements.previewKicker.innerHTML=DiggUtils.stripHtml(this.elements.inputKicker.placeholder),r.state.uri.trim().length>0?this.elements.previewUri.innerHTML=DiggUtils.extractHostname(DiggUtils.stripHtml(r.state.uri)):this.elements.previewUri.innerHTML=DiggUtils.extractHostname(DiggUtils.stripHtml(this.elements.inputUri.placeholder)),r.state.description.trim().length>0?this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(r.state.description):this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(this.elements.inputDescription.placeholder)}destroyCropper(){this.featuredImageCropper&&this.featuredImageCropper.destroy()}saveCroppedImage(){if(this.featuredImageCropper){this.featuredImageCropper.getCroppedCanvas().toBlob((function(e){r.dispatch("setFeaturedImageFileBlob",e),r.dispatch("setFeaturedImageUploadProgress",0)}))}}handleFileUpload(e){r.dispatch("setFeaturedImageFile",e),r.dispatch("setFeaturedImageUploadProgress",0)}initializeCropper(){r.dispatch("setFeaturedImageCroppingStatus",!0),this.featuredImageCropper&&this.featuredImageCropper.destroy(),this.featuredImageCropper=new Cropper(this.elements.imgImage,{checkCrossOrigin:!1,aspectRatio:35/19}),this.imageDropAreaDisableClick()}imageDropAreaDisableClick(){this.elements.divImageDropArea.addEventListener("click",this.stopDefaultAndPropagation)}imageDropAreaEnableClick(){this.elements.divImageDropArea.removeEventListener("click",this.stopDefaultAndPropagation)}stopDefaultAndPropagation(e){e.preventDefault(),e.stopPropagation()}validateUri(){let e=0;this.elements.inputUri.classList.remove("error");const t=this.elements.inputUri.value.trim();return 0===t.length?(e++,this.elements.inputUri.classList.add("error")):isUrl(t)||(e++,this.elements.inputUri.classList.add("error")),e}validateTitle(){let e=0;return this.elements.inputTitle.classList.remove("error"),0===this.elements.inputTitle.value.trim().length&&(e++,this.elements.inputTitle.classList.add("error")),e}validateKicker(){return this.elements.inputKicker.classList.remove("error"),0}validateDescription(){let e=0;return this.elements.inputDescription.classList.remove("error"),0===this.elements.inputDescription.value.trim().length&&(e++,this.elements.inputDescription.classList.add("error")),e}validateForm(){let e=0;return e+=this.validateTitle(),e+=this.validateUri(),e+=this.validateKicker(),e+=this.validateDescription(),0===e}}(new n).render()}})();const submitLinkFormProxy={saveFeaturedImage:(e,t)=>new Promise((function(i,r){var n=new FormData;n.append("featuredImageFile",t);var s=new XMLHttpRequest;s.open("post","/submit-link/upload-featured-image",!0),s.upload.onprogress=function(t){t.lengthComputable&&e.dispatch("setFeaturedImageUploadProgress",t.loaded/t.total*100)},s.upload.addEventListener("timeout",(function(e){r({status:this.status,statusText:s.statusText})})),s.addEventListener("loadend",t=>{e.dispatch("setFeaturedImageUploadProgress",-1)},!1),s.addEventListener("readystatechange",(function(e){4===this.readyState&&i(s.response)})),s.onerror=function(e){r({status:this.status,statusText:s.statusText})},s.send(n)})),saveSubmittedLink:e=>fetch("/submit-link",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({hashId:e.state.hashId,namespaceSlug:e.state.namespaceSlug,title:e.state.title,kicker:e.state.kicker,description:e.state.description,uri:e.state.uri,featuredImageUri:e.state.featuredImageUri})})};(()=>{const e=document.querySelector(".filter-comments"),t=document.querySelector(".flagged-comments");e&&t&&e.addEventListener("keyup",e=>{const i=t.querySelectorAll(".comment-container");let r=e.target.value.toLowerCase();i.forEach(e=>{let t=[];t.push(e.querySelector("h5").innerText.toLowerCase()),t.push(e.querySelector(".contents").innerText.toLowerCase()),t.push(e.querySelector(".by").innerText.toLowerCase()),0==r.length||t.join(" ").indexOf(r)>=0?e.style.display="block":e.style.display="none"})});let i=document.querySelectorAll(".namespace-comments .operations svg"),r=document.querySelectorAll(".namespace-comments .operations .actions");i&&(i.forEach(e=>{e.addEventListener("click",e=>{let t=e.target.parentNode.querySelector(".actions"),i=t.classList.contains("show");r.forEach(e=>{e.classList.remove("show")}),i?t.classList.remove("show"):t.classList.add("show")})}),document.body.addEventListener("click",e=>{e.target.classList.contains("action-icon")||r.forEach(e=>{e.classList.remove("show")})}));let n=document.querySelectorAll(".namespace-comments .operations .actions .delete");n&&n.forEach(e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to delete this comment?")&&(window.location.href=i)})})})(),(()=>{if(document.querySelector(".wrapper .namespace-edit")){const e={setSocialImageUri:(e,t)=>(e.socialImageUri=t,e),setName:(e,t)=>(e.name=t,e),setDescription:(e,t)=>(e.description=t,e),setDisableComments:(e,t)=>(e.disableComments=t,e),setCommentsDefaultDisabled:(e,t)=>(e.commentsDefaultDisabled=t,e),setValidating:(e,t)=>(e.validating=t,e),setSocialImageUploadProgress:(e,t)=>(e.socialImageUploadProgress=t,e),setSocialImageCroppingStatus:(e,t)=>(e.socialImageCroppingStatus=t,e),setSocialImageFinishedUploading:(e,t)=>(e.socialImageFinishedUploading=t,e)},t={setName(e,t){e.commit("setName",t)},setDescription(e,t){e.commit("setDescription",t)},setDisableComments(e,t){e.commit("setDisableComments",t)},setCommentsDefaultDisabled(e,t){e.commit("setCommentsDefaultDisabled",t)},setValidating(e,t){e.commit("setValidating",t)},setSocialImageFileBlob(e,t){namespaceEditFormProxy.saveSocialImage(r,t).then(t=>{let i=JSON.parse(t);i.hasOwnProperty("success")&&"1"===i.success?(e.commit("setSocialImageUri",i.embed.imageUrl),e.dispatch("setSocialImageCroppingStatus",!1)):console.log(t)}).catch(e=>{console.log(e)})},setSocialImageFile(e,t){namespaceEditFormProxy.saveSocialImage(r,t).then(t=>{let i=JSON.parse(t);i.hasOwnProperty("success")&&"1"===i.success?(e.commit("setSocialImageUri",i.embed.imageUrl),e.dispatch("setSocialImageFinishedUploading",!0)):console.log(t)}).catch(e=>{console.log(e)})},setSocialImageUploadProgress(e,t){e.commit("setSocialImageUploadProgress",t)},setSocialImageCroppingStatus(e,t){e.commit("setSocialImageCroppingStatus",t)},setSocialImageFinishedUploading(e,t){e.commit("setSocialImageFinishedUploading",t)}};let i={id:window.namespace.id,slug:window.namespace.slug,name:window.namespace.name?window.namespace.name:"",description:window.namespace.description?window.namespace.description:"",disableComments:!!window.namespace.disableComments&&window.namespace.disableComments,commentsDefaultDisabled:!!window.namespace.commentsDefaultDisabled&&window.namespace.commentsDefaultDisabled,socialImageUri:window.namespace.socialImageUri,socialImageUploadProgress:-1,socialImageCroppingStatus:!1,socialImageFinishedUploading:!1,validating:!1},r=new FsmStore({actions:t,mutations:e,state:i});class n extends FsmComponent{constructor(){super({store:r,elements:{divWrapperNamespaceEdit:document.querySelector(".namespace-edit"),divThankYou:document.querySelector(".namespace-edit__thank-you"),divNamespaceForm:document.querySelector(".namespace-edit-form"),divNamespacePreview:document.querySelector(".namespace-sidebar"),btnSubmit:document.querySelector(".namespace-edit-form__btn"),inputDisableComments:document.querySelector("#namespace-edit-form__disable-comments"),inputCommentsDefaultDisabled:document.querySelector("#namespace-edit-form__comments-default-disabled"),labelCommentsDefaultDisabled:document.querySelector('label[for="namespace-edit-form__comments-default-disabled"]'),inputName:document.querySelector(".namespace-edit-form .namespace-edit-form__name"),inputDescription:document.querySelector(".namespace-edit-form .namespace-edit-form__description"),inputNamespaceId:document.querySelector("#namespace-edit-form__namespace-id"),inputNamespaceSlug:document.querySelector("#namespace-edit-form__namespace-slug"),previewName:document.querySelector(".namespace-sidebar .namespace-sidebar__name"),previewDescription:document.querySelector(".namespace-sidebar .namespace-sidebar__description"),inputSocialShareImageHidden:document.querySelector("#namespace-edit-form__social-image-uri"),divImageDropArea:document.querySelector(".namespace-edit-form__image-drop-area"),inputSocialShareImage:document.querySelector("#namespace-edit-form__social-image-input"),imgSocialShareImage:document.querySelector(".namespace-edit-form__image-wrap img"),divUploadProgress:document.querySelector(".namespace-edit-form__upload-progress"),aCropCommand:document.querySelector(".namespace-edit-form__crop-command"),aCropFinishCommand:document.querySelector(".namespace-edit-form__crop-finish-command"),aCropCancelCommand:document.querySelector(".namespace-edit-form__crop-cancel-command")}}),r.state.name.trim().length>0&&(this.elements.inputName.value=DiggUtils.stripHtml(r.state.name)),r.state.description.trim().length>0&&(this.elements.inputDescription.value=DiggUtils.stripHtml(r.state.description)),this.elements.inputName&&this.elements.previewName&&this.elements.inputName.addEventListener("blur",e=>{if(this.elements.inputName.value.trim().length>0||r.validating){this.validateName();let e=DiggUtils.stripHtml(this.elements.inputName.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputName.placeholder)),r.dispatch("setName",e)}}),this.elements.inputDescription&&this.elements.previewDescription&&this.elements.inputDescription.addEventListener("blur",e=>{if(this.elements.inputDescription.value.trim().length>0||r.validating){this.validateDescription();let e=DiggUtils.stripHtml(this.elements.inputDescription.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputDescription.placeholder.trim())),r.dispatch("setDescription",e)}}),this.elements.aCropCancelCommand&&this.elements.aCropCancelCommand.addEventListener("click",e=>{r.dispatch("setSocialImageCroppingStatus",!1),""!==this.elements.imgSocialShareImage.getAttribute("src")&&(this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.aCropCommand&&this.elements.aCropCommand.addEventListener("click",e=>{""!==this.elements.imgSocialShareImage.getAttribute("src")&&this.initializeCropper(),e.preventDefault()}),this.elements.aCropFinishCommand&&this.elements.aCropFinishCommand.addEventListener("click",e=>{""!==this.elements.imgSocialShareImage.getAttribute("src")&&(this.saveCroppedImage(),this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),r.state.disableComments?this.elements.labelCommentsDefaultDisabled.style.display="none":this.elements.labelCommentsDefaultDisabled.style.display="block";let e=this;this.elements.inputDisableComments&&this.elements.inputDisableComments.addEventListener("change",(function(){r.dispatch("setDisableComments",this.checked),this.checked?(r.dispatch("setCommentsDefaultDisabled",!1),e.elements.labelCommentsDefaultDisabled.style.display="none"):e.elements.labelCommentsDefaultDisabled.style.display="block"})),this.elements.inputCommentsDefaultDisabled&&this.elements.inputCommentsDefaultDisabled.addEventListener("change",(function(){r.dispatch("setCommentsDefaultDisabled",this.checked)})),this.elements.inputSocialShareImage&&this.elements.inputSocialShareImage.addEventListener("change",()=>{this.handleFileUpload(this.elements.inputSocialShareImage.files[0])},!1),this.elements.divImageDropArea&&(this.elements.divImageDropArea.addEventListener("drop",e=>{if(!r.state.socialImageCroppingStatus){this.elements.divImageDropArea.classList.remove("namespace-edit-form__image-drop-area--highlight");let t=e.dataTransfer.files;this.handleFileUpload(t[0])}e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragenter",e=>{r.state.socialImageCroppingStatus||this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragover",e=>{r.state.socialImageCroppingStatus||this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragleave",e=>{this.elements.divImageDropArea.classList.remove("namespace-edit-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1)),this.elements.divThankYou&&this.elements.divNamespaceForm&&this.elements.divNamespacePreview&&this.elements.btnSubmit&&this.elements.btnSubmit.addEventListener("click",e=>{r.dispatch("setValidating",!0),this.validateForm()&&(r.dispatch("setValidating",!1),this.elements.divNamespaceForm.style.display="none",this.elements.divThankYou.style.display="block",namespaceEditFormProxy.saveNamespace(r).then(e=>{}).catch(e=>{console.log(e)})),e.preventDefault()})}render(){r.state.socialImageCroppingStatus?this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--cropping"):this.elements.divImageDropArea.classList.remove("namespace-edit-form__image-drop-area--cropping"),r.state.socialImageFinishedUploading&&(r.dispatch("setSocialImageFinishedUploading",!1),this.initializeCropper()),r.state.socialImageUploadProgress<=-1?this.elements.divUploadProgress.style.display="none":(this.elements.divUploadProgress.style.width=r.state.socialImageUploadProgress+"%",this.elements.divUploadProgress.style.display="block"),r.state.socialImageUri&&r.state.socialImageUri.length>0&&(this.elements.imgSocialShareImage.setAttribute("src",DiggUtils.stripHtml(r.state.socialImageUri)),this.elements.inputSocialShareImageHidden.value=DiggUtils.stripHtml(r.state.socialImageUri),this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--has-image")),r.state.name.trim().length>0?this.elements.previewName.innerHTML=DiggUtils.stripHtml(r.state.name):this.elements.previewName.innerHTML=DiggUtils.stripHtml(this.elements.inputName.placeholder),r.state.description.trim().length>0?this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(r.state.description):this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(this.elements.inputDescription.placeholder)}destroyCropper(){this.socialImageCropper&&this.socialImageCropper.destroy()}saveCroppedImage(){if(this.socialImageCropper){this.socialImageCropper.getCroppedCanvas().toBlob((function(e){r.dispatch("setSocialImageFileBlob",e),r.dispatch("setSocialImageUploadProgress",0)}))}}handleFileUpload(e){r.dispatch("setSocialImageFile",e),r.dispatch("setSocialImageUploadProgress",0)}initializeCropper(){r.dispatch("setSocialImageCroppingStatus",!0),this.socialImageCropper&&this.socialImageCropper.destroy(),this.socialImageCropper=new Cropper(this.elements.imgSocialShareImage,{checkCrossOrigin:!1,aspectRatio:35/19}),this.imageDropAreaDisableClick()}imageDropAreaDisableClick(){this.elements.divImageDropArea.addEventListener("click",this.stopDefaultAndPropagation)}imageDropAreaEnableClick(){this.elements.divImageDropArea.removeEventListener("click",this.stopDefaultAndPropagation)}stopDefaultAndPropagation(e){e.preventDefault(),e.stopPropagation()}validateName(){let e=0;return this.elements.inputName.classList.remove("error"),0===this.elements.inputName.value.trim().length&&(e++,this.elements.inputName.classList.add("error")),e}validateDescription(){let e=0;return this.elements.inputDescription.classList.remove("error"),0===this.elements.inputDescription.value.trim().length&&(e++,this.elements.inputDescription.classList.add("error")),e}validateForm(){let e=0;return e+=this.validateName(),e+=this.validateDescription(),0===e}}(new n).render()}})();const namespaceEditFormProxy={saveSocialImage:(e,t)=>new Promise((function(i,r){var n=new FormData;n.append("socialImageFile",t);var s=new XMLHttpRequest;s.open("post",`/${e.state.slug}/edit/upload-social-image`,!0),s.upload.onprogress=function(t){t.lengthComputable&&e.dispatch("setSocialImageUploadProgress",t.loaded/t.total*100)},s.upload.addEventListener("timeout",(function(e){r({status:this.status,statusText:s.statusText})})),s.addEventListener("loadend",t=>{e.dispatch("setSocialImageUploadProgress",-1)},!1),s.addEventListener("readystatechange",(function(e){4===this.readyState&&i(s.response)})),s.onerror=function(e){r({status:this.status,statusText:s.statusText})},s.send(n)})),saveNamespace:e=>fetch(`/${e.state.slug}/edit`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceId:e.state.id,name:e.state.name,description:e.state.description,socialImageUri:e.state.socialImageUri,disableComments:e.state.disableComments,commentsDefaultDisabled:e.state.commentsDefaultDisabled})})},hideAllShareNamespaceStoryMenus=()=>{const e=document.querySelectorAll(".share-namespace-story");if(e)for(const t of e)t.querySelector(".actions").style.display="none"},shareNamespaceStoryMenu=e=>{const t=e.parentNode.querySelector(".actions");"block"===t.style.display?t.style.display="none":(hideAllShareNamespaceStoryMenus(),t.style.display="block")},shareNamespaceStoryAction=e=>{const t=e.dataset.type,i=e.parentNode.parentNode.querySelector("svg"),r=i.dataset.url,n=i.dataset.title;switch(t){case"facebook":{let e=`https://www.facebook.com/dialog/feed?redirect_uri=${encodeURI("https://digg.com")}&link=${encodeURI(r)}&display=popup&app_id=123277257693179`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=500");break}case"twitter":{let e=`https://twitter.com/intent/tweet?url=${encodeURI(r)}&text=${encodeURI(n)}&via=Digg`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=300");break}case"copy":var s=document.createElement("textarea");s.value=r,s.setAttribute("readonly",""),s.style={position:"absolute",left:"-9999px"},document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}hideAllShareNamespaceStoryMenus()},upvoteNamespaceStory=e=>{const t=e.closest(".submitted-link-card"),i=e.parentNode.querySelector(".score"),r=JSON.parse(localStorage.getItem("digg-upvotes"))||[];r.includes(t.dataset.id)||fetch(`/api/namespace/upvote/${t.dataset.id}`).then(e=>e.json()).then((function(e){const n=parseInt(i.innerText||0,10)+1;r.push(t.dataset.id),localStorage.setItem("digg-upvotes",JSON.stringify(r)),i.innerText=n}))};(()=>{const e=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to delete this link?")&&(window.location.href=i)})},t=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to mark this link as spam?")&&(window.location.href=i)})},i=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to mark this user and all their submitted links as spam?")&&(window.location.href=i)})},r=e=>{e.addEventListener("click",e=>{let t=document.querySelectorAll(".namespace-inbox .operations .actions"),i=e.target.parentNode.querySelector(".actions"),r=i.classList.contains("show");t.forEach(e=>{e.classList.remove("show")}),r?i.classList.remove("show"):i.classList.add("show")})},n=e=>{let t=document.querySelectorAll(".namespace-inbox .operations .actions");e.target.classList.contains("action-icon")||t.forEach(e=>{e.classList.remove("show")})},s=document.querySelector(".filter-links"),o=document.querySelector(".submitted-links");s&&o&&s.addEventListener("keyup",e=>{const t=o.querySelectorAll(".item-container");let i=e.target.value.toLowerCase();t.forEach(e=>{let t=[];t.push(e.querySelector("h5").innerText.toLowerCase()),t.push(e.querySelector(".kicker").innerText.toLowerCase()),t.push(e.querySelector(".by").innerText.toLowerCase()),0==i.length||t.join(" ").indexOf(i)>=0?e.style.display="block":e.style.display="none"})});let a=document.querySelectorAll(".namespace-inbox .operations svg");a&&(a.forEach(e=>r(e)),document.body.removeEventListener("click",n),document.body.addEventListener("click",e=>n(e))),window.addEventListener("submittedLinkLoaded",(function(s){const o=document.querySelector('[data-id="'+s.detail.hashId+'"]');if(o){const s=o.querySelector(".operations svg");if(s){r(s);const a=o.querySelector(".operations .actions .delete");e(a);const p=o.querySelector(".operations .actions .spam");t(p);const l=o.querySelector(".operations .actions .spam-user");i(l),document.body.removeEventListener("click",n),document.body.addEventListener("click",e=>n(e))}}}));let p=document.querySelectorAll(".namespace-inbox .operations .actions .delete");p&&p.forEach(t=>e(t));let l=document.querySelectorAll(".namespace-inbox .operations .actions .spam");l&&l.forEach(e=>t(e));let c=document.querySelectorAll(".namespace-inbox .operations .actions .spam-user");c&&c.forEach(e=>i(e))})(),(()=>{let e=document.querySelectorAll(".load-more-stories");e&&(Twig.cache(!0),e.forEach(e=>{e.addEventListener("click",t=>{let i=e.dataset.endpoint,r=e.dataset.view,n=document.querySelector(`.${e.dataset.placeholder}`),s=parseInt(e.dataset.total),o=parseInt(e.dataset.size),a=parseInt(e.dataset.page),p=o*a,l=twig({href:`components/story-cards/${r}/${r}.twig`,async:!1});l.render(),e.querySelector("span").style.display="none",e.querySelector("img").style.display="inline-block",fetch(`/api/${i}&from=${p}&size=${o}`).then(e=>e.json()).then((function(t){t&&t.mapped&&l&&l.macros?t.mapped.forEach(t=>{if(Object.keys(l.macros)&&Object.keys(l.macros)[0]&&l.macros[Object.keys(l.macros)[0]]&&l.macros[Object.keys(l.macros)[0]](t)){let i=(new DOMParser).parseFromString(l.macros[Object.keys(l.macros)[0]](t),"text/html").querySelector("article");n.appendChild(i),e.dataset.page=a+1,e.querySelector("span").style.display="block",e.querySelector("img").style.display="none"}else e.style.display="none"}):e.style.display="none"})).catch(t=>{e.style.display="none"}),(a+1)*o>s&&(e.style.display="none")})}))})(),(()=>{let e=document.querySelectorAll(".load-more-submitted-links");e&&(Twig.cache(!0),e.forEach(e=>{e.addEventListener("click",t=>{let i="";e.classList.contains("load-more-submitted-links--published")?i="/api/namespace/submitted-links":e.classList.contains("load-more-submitted-links--submissions")?i="/api/namespace/submitted-links-submissions":e.classList.contains("load-more-submitted-links--spam")&&(i="/api/namespace/submitted-links-spam");let r=e.dataset.namespace,n=e.dataset.view,s=document.querySelector(`.${e.dataset.placeholder}`),o=parseInt(e.dataset.total),a=parseInt(e.dataset.size),p=parseInt(e.dataset.page),l=a*p,c=twig({href:`/components/namespace/${n}/${n}-link.twig`,async:!1});c.render(),e.querySelector("span").style.display="none",e.querySelector("img").style.display="inline-block",fetch(`${i}?namespace=${r}&from=${l}&size=${a}`).then(e=>e.json()).then((function(t){t&&t.mapped&&c&&c.macros?t.mapped.forEach(t=>{if(Object.keys(c.macros)&&Object.keys(c.macros)[0]&&c.macros[Object.keys(c.macros)[0]]&&c.macros[Object.keys(c.macros)[0]](t)){let i=(new DOMParser).parseFromString(c.macros[Object.keys(c.macros)[0]](t),"text/html").querySelector("article");s.appendChild(i),e.dataset.page=p+1,window.dispatchEvent(new CustomEvent("submittedLinkLoaded",{detail:{hashId:t.hashId}})),e.querySelector("span").style.display="block",e.querySelector("img").style.display="none"}else e.style.display="none"}):e.style.display="none"})).catch(t=>{e.style.display="none"}),(p+1)*a>o&&(e.style.display="none")})}))})();const isURL=e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e);document.querySelectorAll(".share-story span").forEach(e=>{e.addEventListener("click",e=>{const t=e.target,i=t.dataset.controller,r=t.parentNode.dataset.id,n=t.parentNode.dataset.title;let s=t.parentNode.dataset.url;var o;switch(o=s,new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(o)||(s=window.location.origin+s),i){case"digg":{let e=t.classList.contains("active")?"remove-digg":"add-digg";fetch(`/api/user-data?method=${e}&id=${r}`).then(e=>e.json()).then((function(e){401==e.status&&(window.location="/welcome"),"add-digg"==e.method?t.classList.add("active"):t.classList.remove("active")}));break}case"save":{let e=t.classList.contains("active")?"remove-save":"add-save";fetch(`/api/user-data?method=${e}&id=${r}`).then(e=>e.json()).then((function(e){401==e.status&&(window.location="/welcome"),"add-save"==e.method?t.classList.add("active"):t.classList.remove("active")}));break}case"twitter":{let e=`https://twitter.com/intent/tweet?url=${encodeURI(s)}&text=${encodeURI(n)}&via=Digg`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=300");break}case"facebook":{let e=`https://www.facebook.com/dialog/feed?redirect_uri=${encodeURI("https://digg.com")}&link=${encodeURI(s)}&display=popup&app_id=123277257693179`;console.log(e),window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=500");break}}})});