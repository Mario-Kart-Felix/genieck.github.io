"use strict";var MD5=function(e){function f(a,b){return a<<b|a>>>32-b}function g(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function h(a,b,c){return a&b|~a&c}function i(a,b,c){return a&c|b&~c}function j(a,b,c){return a^b^c}function l(a,b,c){return b^(a|~c)}function m(e,i,b,c,d,j,k){return e=g(e,g(g(h(i,b,c),d),k)),g(f(e,j),i)}function n(e,h,b,c,d,j,k){return e=g(e,g(g(i(h,b,c),d),k)),g(f(e,j),h)}function o(e,h,b,c,d,i,k){return e=g(e,g(g(j(h,b,c),d),k)),g(f(e,i),h)}function p(e,h,b,c,d,i,j){return e=g(e,g(g(l(h,b,c),d),j)),g(f(e,i),h)}function q(a){for(var b,c=a.length,d=c+8,e=16*((d-d%64)/64+1),f=Array(e-1),g=0,h=0;h<c;)b=(h-h%4)/4,g=8*(h%4),f[b]|=a.charCodeAt(h)<<g,h++;return b=(h-h%4)/4,g=8*(h%4),f[b]|=128<<g,f[e-2]=c<<3,f[e-1]=c>>>29,f}function r(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=255&a>>>8*c,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function s(a){var b=String.fromCharCode;a=a.replace(/\r\n/g,"\n");for(var d,e="",f=0;f<a.length;f++)d=a.charCodeAt(f),128>d?e+=b(d):127<d&&2048>d?(e+=b(192|d>>6),e+=b(128|63&d)):(e+=b(224|d>>12),e+=b(128|63&d>>6),e+=b(128|63&d));return e}var t,u,v,w,y,z,A,B,C,D=[],E=7,F=12,G=17,H=22,I=5,J=9,K=14,L=20,M=4,N=11,O=16,P=23,Q=6,R=10,S=15,T=21;for(e=s(e),D=q(e),z=1732584193,A=4023233417,B=2562383102,C=271733878,t=0;t<D.length;t+=16)u=z,v=A,w=B,y=C,z=m(z,A,B,C,D[t+0],E,3614090360),C=m(C,z,A,B,D[t+1],F,3905402710),B=m(B,C,z,A,D[t+2],G,606105819),A=m(A,B,C,z,D[t+3],H,3250441966),z=m(z,A,B,C,D[t+4],E,4118548399),C=m(C,z,A,B,D[t+5],F,1200080426),B=m(B,C,z,A,D[t+6],G,2821735955),A=m(A,B,C,z,D[t+7],H,4249261313),z=m(z,A,B,C,D[t+8],E,1770035416),C=m(C,z,A,B,D[t+9],F,2336552879),B=m(B,C,z,A,D[t+10],G,4294925233),A=m(A,B,C,z,D[t+11],H,2304563134),z=m(z,A,B,C,D[t+12],E,1804603682),C=m(C,z,A,B,D[t+13],F,4254626195),B=m(B,C,z,A,D[t+14],G,2792965006),A=m(A,B,C,z,D[t+15],H,1236535329),z=n(z,A,B,C,D[t+1],I,4129170786),C=n(C,z,A,B,D[t+6],J,3225465664),B=n(B,C,z,A,D[t+11],K,643717713),A=n(A,B,C,z,D[t+0],L,3921069994),z=n(z,A,B,C,D[t+5],I,3593408605),C=n(C,z,A,B,D[t+10],J,38016083),B=n(B,C,z,A,D[t+15],K,3634488961),A=n(A,B,C,z,D[t+4],L,3889429448),z=n(z,A,B,C,D[t+9],I,568446438),C=n(C,z,A,B,D[t+14],J,3275163606),B=n(B,C,z,A,D[t+3],K,4107603335),A=n(A,B,C,z,D[t+8],L,1163531501),z=n(z,A,B,C,D[t+13],I,2850285829),C=n(C,z,A,B,D[t+2],J,4243563512),B=n(B,C,z,A,D[t+7],K,1735328473),A=n(A,B,C,z,D[t+12],L,2368359562),z=o(z,A,B,C,D[t+5],M,4294588738),C=o(C,z,A,B,D[t+8],N,2272392833),B=o(B,C,z,A,D[t+11],O,1839030562),A=o(A,B,C,z,D[t+14],P,4259657740),z=o(z,A,B,C,D[t+1],M,2763975236),C=o(C,z,A,B,D[t+4],N,1272893353),B=o(B,C,z,A,D[t+7],O,4139469664),A=o(A,B,C,z,D[t+10],P,3200236656),z=o(z,A,B,C,D[t+13],M,681279174),C=o(C,z,A,B,D[t+0],N,3936430074),B=o(B,C,z,A,D[t+3],O,3572445317),A=o(A,B,C,z,D[t+6],P,76029189),z=o(z,A,B,C,D[t+9],M,3654602809),C=o(C,z,A,B,D[t+12],N,3873151461),B=o(B,C,z,A,D[t+15],O,530742520),A=o(A,B,C,z,D[t+2],P,3299628645),z=p(z,A,B,C,D[t+0],Q,4096336452),C=p(C,z,A,B,D[t+7],R,1126891415),B=p(B,C,z,A,D[t+14],S,2878612391),A=p(A,B,C,z,D[t+5],T,4237533241),z=p(z,A,B,C,D[t+12],Q,1700485571),C=p(C,z,A,B,D[t+3],R,2399980690),B=p(B,C,z,A,D[t+10],S,4293915773),A=p(A,B,C,z,D[t+1],T,2240044497),z=p(z,A,B,C,D[t+8],Q,1873313359),C=p(C,z,A,B,D[t+15],R,4264355552),B=p(B,C,z,A,D[t+6],S,2734768916),A=p(A,B,C,z,D[t+13],T,1309151649),z=p(z,A,B,C,D[t+4],Q,4149444226),C=p(C,z,A,B,D[t+11],R,3174756917),B=p(B,C,z,A,D[t+2],S,718787259),A=p(A,B,C,z,D[t+9],T,3951481745),z=g(z,u),A=g(A,v),B=g(B,w),C=g(C,y);var U=r(z)+r(A)+r(B)+r(C);return U.toLowerCase()};
"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}(function(){var a=Math.ceil,b=_asyncToGenerator(function*(b){var c=Math.floor;const d="peruse-paths",e=localStorage.getItem("peruse-enable-debug-logs"),f=localStorage.getItem("peruse-dont-store-in-ls"),g=a=>(a=a.replace(/(^\s*)|(\s*$)/gi,""),a=a.replace(/[ ]{2,}/gi," "),a=a.replace(/\n /,"\n"),a.split(" ").length),h=(b,c)=>a(b/c);if(b.displayPeruseStats=()=>{console.table(peruseStats)},b.displayPerusePaths=()=>{console.table(JSON.parse(localStorage.getItem(d)))},"undefined"!=typeof Storage){const a=document.currentScript,i="localhost"==b.location.hostname?"http://localhost:4000/api/v1/tracker":"https://app.peruse.ai/api/v1/tracker";b.peruseStats={ignoreIndex:!1,start:new Date,timer:null,words:0,estimate:0,progress:0,diff:0,reachedBottom:!1,hasRead:!1,wpm:250,version:"2020-04-08"};const j=localStorage.getItem(d)?JSON.parse(localStorage.getItem(d)):{};if(!a.dataset.pathname)return void console.info(">> peruse:","no pathname defined in tracking code");const k=a.dataset.pathname,l=MD5(k);a.dataset.wpm&&(peruseStats.wpm=parseInt(a.dataset.wpm,10));const m=a.dataset.articleQuerySelector?document.querySelector(a.dataset.articleQuerySelector):document.querySelector("article");if(!m)return void(e&&console.info(">> peruse:","no article selected for tracking"));if(peruseStats.words=g(m.innerText),peruseStats.estimate=h(peruseStats.words,peruseStats.wpm),j[l]||(j[l]={pathname:k,viewed:!1,viewedAt:null,read:!1,readAt:null},!f&&localStorage.setItem(d,JSON.stringify(j))),j[l].viewed&&j[l].read)return;if(!j[l].viewed){let b=document.title,g=null,h=null;try{g=document.querySelector("meta[name=\"description\"]").content}catch(a){console.info(a)}try{h=document.querySelector("meta[property=\"article:section\"]").content}catch(a){console.info(a)}let m={title:b,description:g,vertical:h,pathname:k,querySelector:a.dataset.articleQuerySelector};const n=yield fetch(`${i}/views?ts=${c(Date.now()/1e3)}`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(m)});yield n.json(),j[l].viewed=!0,j[l].viewedAt=new Date,e&&console.info(">> peruse:","view trigger sent to server"),f||localStorage.setItem(d,JSON.stringify(j))}j[l].read||(peruseStats.timer=setInterval(()=>{var a=Math.round;if(j[l].viewed){if(!peruseStats.hasRead&&100>peruseStats.progress?(peruseStats.diff=a((new Date().getTime()-peruseStats.start.getTime())/1e3),peruseStats.progress=a(100*(100*peruseStats.diff/(60*peruseStats.estimate)))/100):(peruseStats.hasRead=!0,e&&console.info(">> peruse:","article was read")),!peruseStats.reachedBottom){const a=m.getBoundingClientRect(),c=parseInt(m.offsetHeight+a.top,10),d=c-b.innerHeight;0>d&&(peruseStats.reachedBottom=!0,e&&console.info(">> peruse:","bottom reached"))}peruseStats.hasRead&&peruseStats.reachedBottom&&(clearInterval(peruseStats.timer),!j[l].read&&fetch(`${i}/reads?ts=${c(Date.now()/1e3)}`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({pathname:k})}).then(()=>{j[l].read=!0,j[l].readAt=new Date,e&&console.info(">> peruse:","read trigger sent to server"),f||localStorage.setItem(d,JSON.stringify(j))}))}},500))}else console.info(">> peruse:","no web storage support")});return function(){return b.apply(this,arguments)}})()(window);
